<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msvalidate.01" content="09940DFE4C5DA4E85A7117EF7EEC3933">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"acomma.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="最近读到一篇非常好的文章 PostgreSQL 中 timestamp 与 timestamptz 的区别，也可以访问 https:&#x2F;&#x2F;japinli.github.io&#x2F;2023&#x2F;03&#x2F;postgresql-timestamp&#x2F;，读完这篇文章后学习到了两点  PostgreSQL 存在两个纪元，Unix 纪元（1970-01-01 00:00:00）和 PostgreSQL 纪元（2000-01">
<meta property="og:type" content="article">
<meta property="og:title" content="PostgreSQL 中的时间戳">
<meta property="og:url" content="https://acomma.github.io/2024/05/24/the-timestamp-in-postgresql/index.html">
<meta property="og:site_name" content="逗号的博客">
<meta property="og:description" content="最近读到一篇非常好的文章 PostgreSQL 中 timestamp 与 timestamptz 的区别，也可以访问 https:&#x2F;&#x2F;japinli.github.io&#x2F;2023&#x2F;03&#x2F;postgresql-timestamp&#x2F;，读完这篇文章后学习到了两点  PostgreSQL 存在两个纪元，Unix 纪元（1970-01-01 00:00:00）和 PostgreSQL 纪元（2000-01">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://acomma.github.io/2024/05/24/the-timestamp-in-postgresql/convert-update-time.png">
<meta property="og:image" content="https://acomma.github.io/2024/05/24/the-timestamp-in-postgresql/convert-create-time.png">
<meta property="og:image" content="https://acomma.github.io/2024/05/24/the-timestamp-in-postgresql/convert-create-time-tokyo.png">
<meta property="article:published_time" content="2024-05-24T14:13:06.000Z">
<meta property="article:modified_time" content="2024-05-30T14:13:06.000Z">
<meta property="article:author" content="逗号">
<meta property="article:tag" content="PostgreSQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://acomma.github.io/2024/05/24/the-timestamp-in-postgresql/convert-update-time.png">


<link rel="canonical" href="https://acomma.github.io/2024/05/24/the-timestamp-in-postgresql/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://acomma.github.io/2024/05/24/the-timestamp-in-postgresql/","path":"2024/05/24/the-timestamp-in-postgresql/","title":"PostgreSQL 中的时间戳"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>PostgreSQL 中的时间戳 | 逗号的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">逗号的博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">这里有一句格言，但我还没想好</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E7%A4%BA%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.</span> <span class="nav-text">表示时间戳的数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E8%BE%93%E5%85%A5%E6%A0%BC%E5%BC%8F"><span class="nav-number">2.</span> <span class="nav-text">时间戳的输入格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F"><span class="nav-number">3.</span> <span class="nav-text">时间戳的输出格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E6%97%B6%E9%97%B4%E6%88%B3"><span class="nav-number">4.</span> <span class="nav-text">如何存储时间戳</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E5%BD%93%E5%89%8D%E6%97%B6%E5%8C%BA"><span class="nav-number">4.1.</span> <span class="nav-text">如何确定当前时区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E5%BD%93%E5%89%8D%E6%97%B6%E5%8C%BA"><span class="nav-number">4.2.</span> <span class="nav-text">如何修改当前时区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E5%AD%98%E5%82%A8%E5%B0%BA%E5%AF%B8"><span class="nav-number">4.3.</span> <span class="nav-text">时间戳的存储尺寸</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8-timestamptz-%E6%97%B6%E7%9A%84%E8%BD%AC%E6%8D%A2%E9%80%BB%E8%BE%91"><span class="nav-number">4.4.</span> <span class="nav-text">存储 timestamptz 时的转换逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#timestamptz-%E7%9A%84%E6%98%BE%E7%A4%BA%E9%80%BB%E8%BE%91"><span class="nav-number">4.4.1.</span> <span class="nav-text">timestamptz 的显示逻辑</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8-timestamp-%E6%97%B6%E7%9A%84%E8%BD%AC%E6%8D%A2%E9%80%BB%E8%BE%91"><span class="nav-number">4.5.</span> <span class="nav-text">存储 timestamp 时的转换逻辑</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">5.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">逗号</p>
  <div class="site-description" itemprop="description">这里是站点描述，但我没有写</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/acomma" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;acomma" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:acomma@yeah.net" title="E-Mail → mailto:acomma@yeah.net" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://acomma.github.io/2024/05/24/the-timestamp-in-postgresql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="逗号">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逗号的博客">
      <meta itemprop="description" content="这里是站点描述，但我没有写">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="PostgreSQL 中的时间戳 | 逗号的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          PostgreSQL 中的时间戳
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-05-24 22:13:06" itemprop="dateCreated datePublished" datetime="2024-05-24T22:13:06+08:00">2024-05-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-05-30 22:13:06" itemprop="dateModified" datetime="2024-05-30T22:13:06+08:00">2024-05-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>最近读到一篇非常好的文章 <a target="_blank" rel="noopener" href="https://blog.japinli.top/2023/03/postgresql-timestamp/">PostgreSQL 中 timestamp 与 timestamptz 的区别</a>，也可以访问 <a target="_blank" rel="noopener" href="https://japinli.github.io/2023/03/postgresql-timestamp/">https://japinli.github.io/2023/03/postgresql-timestamp/</a>，读完这篇文章后学习到了两点</p>
<ol>
<li>PostgreSQL 存在两个纪元，Unix 纪元（1970-01-01 00:00:00）和 PostgreSQL 纪元（2000-01-01 00:00:00），在底层存储系统存储的是时间相对于 PostgreSQL 纪元的数值。<code>EXTRACT(EPOCH FROM source)</code> 是基于 Unix 纪元的结果。</li>
<li>顺藤摸瓜可以阅读 <code>src/backend/utils/adt/timestamp.c</code> 文件中的 <code>timestamp_in</code> 和 <code>timestamp_out</code> 函数，从源码上理解时间字符串的输入和输出逻辑。</li>
</ol>
<p>因此本文的逻辑是基于显示的结果而言，从显示的结果推论可能的原因，只是为了方便理解。推荐阅读它而不是本文。</p>
<span id="more"></span>

<h2 id="表示时间戳的数据类型"><a href="#表示时间戳的数据类型" class="headerlink" title="表示时间戳的数据类型"></a>表示时间戳的数据类型</h2><p>PostgreSQL 提供了 <code>timestamp</code> 和 <code>timestamptz</code> 两种数据类型来表示时间戳，它们分别是 <code>timestamp without time zone</code> 和 <code>timestamp with time zone</code> 的缩写。<code>timestamp</code> 是标准 SQL 支持的缩写，而 <code>timestamptz</code> 是一种 PostgreSQL 的扩展。从它们的名字就可以知道 <code>timestamp</code> 不包含时区信息，而 <code>timestamptz</code> 包含。</p>
<p>为了学习 PostgreSQL 的时间戳类型我们创建一个测试表 <code>label</code>，每个字段的说明参考下面的建表语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> label</span><br><span class="line">(</span><br><span class="line">    id          SERIAL,      <span class="comment">-- ID</span></span><br><span class="line">    name        <span class="type">VARCHAR</span>,     <span class="comment">-- 标签名称</span></span><br><span class="line">    create_time <span class="type">TIMESTAMP</span>,   <span class="comment">-- 创建时间（无时区）</span></span><br><span class="line">    update_time TIMESTAMPTZ, <span class="comment">-- 更新时间（有时区）</span></span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="时间戳的输入格式"><a href="#时间戳的输入格式" class="headerlink" title="时间戳的输入格式"></a>时间戳的输入格式</h2><blockquote>
<p>Valid input for the time stamp types consists of the concatenation of a date and a time, followed by an optional time zone, followed by an optional <code>AD</code> or <code>BC</code>. (Alternatively, <code>AD</code>&#x2F;<code>BC</code> can appear before the time zone, but this is not the preferred ordering.) Thus: <code>1999-01-08 04:05:06</code> and: <code>1999-01-08 04:05:06 -8:00</code> are valid values, which follow the ISO 8601 standard.</p>
<p>The SQL standard differentiates <code>timestamp without time zone</code> and <code>timestamp with time zone</code> literals by the presence of a “+” or “-” symbol and time zone offset after the time. Hence, according to the standard, <code>TIMESTAMP &#39;2004-10-19 10:23:54&#39;</code> is a <code>timestamp without time zone</code>, while <code>TIMESTAMP &#39;2004-10-19 10:23:54+02&#39;</code> is a <code>timestamp with time zone</code>. PostgreSQL never examines the content of a literal string before determining its type, and therefore will treat both of the above as <code>timestamp without time zone</code>. To ensure that a literal is treated as <code>timestamp with time zone</code>, give it the correct explicit type: <code>TIMESTAMP WITH TIME ZONE &#39;2004-10-19 10:23:54+02&#39;</code>.</p>
<p>In a literal that has been determined to be <code>timestamp without time zone</code>, PostgreSQL will silently ignore any time zone indication. That is, the resulting value is derived from the date&#x2F;time fields in the input value, and is not adjusted for time zone.</p>
</blockquote>
<p>从这一段描述中我们知道 PostgreSQL 接受 ISO 格式的时间戳，因此我们可以构建下面的插入语句，<code>&#39;2024-05-23 20:17:25&#39;</code> 是我们输入的创建时间，不带时区信息；而 <code>&#39;2024-05-23 20:17:25+08&#39;</code> 是我们输入的更新时间，带有时区信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">INSERT INTO</span> label(name, create_time, update_time) <span class="keyword">VALUES</span> (<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;2024-05-23 20:17:25&#x27;</span>, <span class="string">&#x27;2024-05-23 20:17:25+08&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="时间戳的输出格式"><a href="#时间戳的输出格式" class="headerlink" title="时间戳的输出格式"></a>时间戳的输出格式</h2><blockquote>
<p>The output format of the date&#x2F;time types can be set to one of the four styles ISO 8601, SQL (Ingres), traditional POSTGRES (Unix date format), or German. The default is the ISO format. (The SQL standard requires the use of the ISO 8601 format. The name of the “SQL” output format is a historical accident.)</p>
<p>ISO 8601 specifies the use of uppercase letter <code>T</code> to separate the date and time. PostgreSQL accepts that format on input, but on output it uses a space rather than <code>T</code>, as shown above. This is for readability and for consistency with RFC 3339 as well as some other database systems.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> label;</span><br><span class="line"> id <span class="operator">|</span> name <span class="operator">|</span>     create_time     <span class="operator">|</span>      update_time</span><br><span class="line"><span class="comment">----+------+---------------------+------------------------</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> aaa  <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span> <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">17</span>:<span class="number">25</span><span class="operator">+</span><span class="number">00</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure>

<p>PostgreSQL 默认输出 ISO 格式。我们发现创建时间和我们输入的时间字符串是一样的，而更新时间和我们输入的时间字符串不一样，一个是小时数少了 <code>8</code> 小时，另一个是时区部分变成了 <code>+00</code>。这是为什么呢？</p>
<h2 id="如何存储时间戳"><a href="#如何存储时间戳" class="headerlink" title="如何存储时间戳"></a>如何存储时间戳</h2><h3 id="如何确定当前时区"><a href="#如何确定当前时区" class="headerlink" title="如何确定当前时区"></a>如何确定当前时区</h3><blockquote>
<p>The built-in default is <code>GMT</code>, but that is typically overridden in <code>postgresql.conf</code>; initdb will install a setting there corresponding to its system environment.</p>
<p>The <a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/12/runtime-config-client.html#GUC-TIMEZONE">TimeZone</a> configuration parameter can be set in the file <code>postgresql.conf</code>, or in any of the other standard ways described in <a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/12/runtime-config.html">Chapter 19</a>. There are also some special ways to set it:</p>
<ul>
<li>The SQL command <code>SET TIME ZONE</code> sets the time zone for the session. This is an alternative spelling of <code>SET TIMEZONE TO</code> with a more SQL-spec-compatible syntax.</li>
<li>The <code>PGTZ</code> environment variable is used by libpq clients to send a <code>SET TIME ZONE</code> command to the server upon connection.</li>
</ul>
</blockquote>
<p>在服务器端通过查看 <code>postgresql.conf</code> 文件中 <code>timezone</code> 的值确定当前时区，目前为 <code>Etc/UTC</code>，即 UTC（UTC+0，零时区，下同）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /var/lib/postgresql/data/postgresql.conf | grep ^timezone</span></span><br><span class="line">timezone = &#x27;Etc/UTC&#x27;</span><br></pre></td></tr></table></figure>

<p>在 <code>psql</code> 客户端使用 <code>SHOW TIME ZONE</code> 来查看当前时区，目前与我们服务器设置的时区一致</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">SHOW</span> <span class="type">TIME</span> ZONE;</span><br><span class="line"> TimeZone</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line"> Etc<span class="operator">/</span>UTC</span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure>

<h3 id="如何修改当前时区"><a href="#如何修改当前时区" class="headerlink" title="如何修改当前时区"></a>如何修改当前时区</h3><p>在服务器端通过编辑 <code>postgresql.conf</code> 文件的 <code>timezone</code> 配置来修改时区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sed -i <span class="string">&quot;s/timezone = &#x27;Etc\/UTC&#x27;/timezone = &#x27;Asia\/Shanghai&#x27;/&quot;</span> /var/lib/postgresql/data/postgresql.conf</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># cat /var/lib/postgresql/data/postgresql.conf | grep ^timezone</span></span></span><br><span class="line">timezone = &#x27;Asia/Shanghai&#x27;</span><br></pre></td></tr></table></figure>

<p>在 <code>psql</code> 客户端使用 <code>SET TIME ZONE</code> 来修改当前时区，这个命令修改的是当前会话的时区，不影响服务器和其他客户端的时区</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">SET</span> <span class="type">TIME</span> ZONE <span class="string">&#x27;Asia/Shanghai&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">test<span class="operator">=</span># <span class="keyword">SHOW</span> <span class="type">TIME</span> ZONE;</span><br><span class="line">   TimeZone</span><br><span class="line"><span class="comment">---------------</span></span><br><span class="line"> Asia<span class="operator">/</span>Shanghai</span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure>

<h3 id="时间戳的存储尺寸"><a href="#时间戳的存储尺寸" class="headerlink" title="时间戳的存储尺寸"></a>时间戳的存储尺寸</h3><p><code>timestamp</code> 和 <code>timestamptz</code> 的存储尺寸都是 8 个字节，可以通过下面的查询进行验证</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">SELECT</span> typname, typlen <span class="keyword">FROM</span> pg_type <span class="keyword">WHERE</span> typname <span class="operator">~</span> <span class="string">&#x27;^timestamp&#x27;</span>;</span><br><span class="line">   typname   <span class="operator">|</span> typlen</span><br><span class="line"><span class="comment">-------------+--------</span></span><br><span class="line"> <span class="type">timestamp</span>   <span class="operator">|</span>      <span class="number">8</span></span><br><span class="line"> timestamptz <span class="operator">|</span>      <span class="number">8</span></span><br><span class="line">(<span class="number">2</span> <span class="keyword">rows</span>)</span><br></pre></td></tr></table></figure>

<p>8 个字节显然是存不下类似 <code>2024-05-23 20:17:25</code> 这样的时间字符串的，更不要说 <code>2024-05-23 20:17:25+08</code> 这种带时区的更长的字符串了。那么我们可以猜测在内部是使用数值存储时间的，即存储的是<strong>距离某个时间的间隔</strong>。这个<em>某个时间</em>是多少呢？</p>
<p>我们查看 <code>EXTRACT(field FROM source)</code> 函数在 <code>field</code> 为 <code>EPOCH</code> 时的说明如下</p>
<blockquote>
<p>For <code>timestamp with time zone</code> values, the number of seconds since 1970-01-01 00:00:00 UTC (negative for timestamps before that); for <code>date</code> and <code>timestamp</code> values, the nominal number of seconds since 1970-01-01 00:00:00, without regard to timezone or daylight-savings rules; for interval values, the total number of seconds in the interval</p>
</blockquote>
<p>1970-01-01 00:00:00 UTC 就是那个<em>某个时间</em>，也被称为<strong>纪元时间</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">SELECT</span> id, name, create_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> create_time) <span class="keyword">AS</span> create_time_epoch, update_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> update_time) <span class="keyword">AS</span> update_time_epoch <span class="keyword">FROM</span> label;</span><br><span class="line"> id <span class="operator">|</span> name <span class="operator">|</span>     create_time     <span class="operator">|</span> create_time_epoch <span class="operator">|</span>      update_time       <span class="operator">|</span> update_time_epoch</span><br><span class="line"><span class="comment">----+------+---------------------+-------------------+------------------------+-------------------</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> aaa  <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span> <span class="operator">|</span>        <span class="number">1716495445</span> <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">17</span>:<span class="number">25</span><span class="operator">+</span><span class="number">00</span> <span class="operator">|</span>        <span class="number">1716466645</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure>

<p>总结一下，PostgreSQL 不会保存时区信息，在内部将输入的时间转换为距离 1970-01-01 00:00:00 UTC 的秒数（根据设置的精度 <code>p</code> 可能包含小数）。</p>
<h3 id="存储-timestamptz-时的转换逻辑"><a href="#存储-timestamptz-时的转换逻辑" class="headerlink" title="存储 timestamptz 时的转换逻辑"></a>存储 timestamptz 时的转换逻辑</h3><blockquote>
<p>For <code>timestamp with time zone</code>, the internally stored value is always in UTC (Universal Coordinated Time, traditionally known as Greenwich Mean Time, GMT). An input value that has an explicit time zone specified is converted to UTC using the appropriate offset for that time zone.</p>
</blockquote>
<p>更新时间 <code>&#39;2024-05-23 20:17:25+08&#39;</code> 有明确的时区声明，其中 <code>+08</code> 表示 UTC+8（东八区），它和 UTC 之间相差 8 小时，所以它减去 8 小时为 <code>2024-05-23 12:17:25+00</code>，再把它转换为距离 1970-01-01 00:00:00 UTC 的秒数 1716466645 进行存储。下面是使用工具 <a target="_blank" rel="noopener" href="https://tool.lu/timestamp/">https://tool.lu/timestamp</a> 转换的结果</p>
<img src="/2024/05/24/the-timestamp-in-postgresql/convert-update-time.png" class="">

<p>同时我们需要注意，具体应该减去多少时区偏移值只与输入时间中识别到时区有关，与服务器或客户端设置的时区无关，这一点可以参考下面标签 bbb 和 ccc 输入的更新时间的显示结果。</p>
<h4 id="timestamptz-的显示逻辑"><a href="#timestamptz-的显示逻辑" class="headerlink" title="timestamptz 的显示逻辑"></a>timestamptz 的显示逻辑</h4><blockquote>
<p>When a <code>timestamp with time zone</code> value is output, it is always converted from UTC to the current <code>timezone</code> zone, and displayed as local time in that zone. To see the time in another time zone, either change <code>timezone</code> or use the <code>AT TIME ZONE</code> construct (see <a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/12/functions-datetime.html#FUNCTIONS-DATETIME-ZONECONVERT">Section 9.9.3</a>).</p>
</blockquote>
<p>因此，内部存储的更新时间 1716466645 从 UTC 时区转换为当前时区 UTC 进行显示即为 <code>2024-05-23 12:17:25+00</code>。当我们把当前时区修改为 UTC+8 时又会显示为东八区的时间，即我们输入的时间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">SET</span> <span class="type">TIME</span> ZONE <span class="string">&#x27;Asia/Shanghai&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">test<span class="operator">=</span># <span class="keyword">SELECT</span> id, name, create_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> create_time) <span class="keyword">AS</span> create_time_epoch, update_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> update_time) <span class="keyword">AS</span> update_time_epoch <span class="keyword">FROM</span> label;</span><br><span class="line"> id <span class="operator">|</span> name <span class="operator">|</span>     create_time     <span class="operator">|</span> create_time_epoch <span class="operator">|</span>      update_time       <span class="operator">|</span> update_time_epoch</span><br><span class="line"><span class="comment">----+------+---------------------+-------------------+------------------------+-------------------</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> aaa  <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span> <span class="operator">|</span>        <span class="number">1716495445</span> <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span><span class="operator">+</span><span class="number">08</span> <span class="operator">|</span>        <span class="number">1716466645</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure>

<p>当我们把当前时区修改为 UTC+9 时又会显示为东九区的时间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">SET</span> <span class="type">TIME</span> ZONE <span class="string">&#x27;Asia/Tokyo&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">test<span class="operator">=</span># <span class="keyword">SELECT</span> id, name, create_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> create_time) <span class="keyword">AS</span> create_time_epoch, update_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> update_time) <span class="keyword">AS</span> update_time_epoch <span class="keyword">FROM</span> label;</span><br><span class="line"> id <span class="operator">|</span> name <span class="operator">|</span>     create_time     <span class="operator">|</span> create_time_epoch <span class="operator">|</span>      update_time       <span class="operator">|</span> update_time_epoch</span><br><span class="line"><span class="comment">----+------+---------------------+-------------------+------------------------+-------------------</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> aaa  <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span> <span class="operator">|</span>        <span class="number">1716495445</span> <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">17</span>:<span class="number">25</span><span class="operator">+</span><span class="number">09</span> <span class="operator">|</span>        <span class="number">1716466645</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure>

<p>同时我们发现无论我们怎么改变时区 <code>EXTRACT</code> 函数的输出始终没有改变，它始终显示的是距离纪元时间的秒数。</p>
<h3 id="存储-timestamp-时的转换逻辑"><a href="#存储-timestamp-时的转换逻辑" class="headerlink" title="存储 timestamp 时的转换逻辑"></a>存储 timestamp 时的转换逻辑</h3><blockquote>
<p>If no time zone is stated in the input string, then it is assumed to be in the time zone indicated by the system’s <a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/12/runtime-config-client.html#GUC-TIMEZONE">TimeZone</a> parameter, and is converted to UTC using the offset for the timezone zone.</p>
</blockquote>
<p>创建时间 <code>&#39;2024-05-23 20:17:25&#39;</code> 没有时区，它将按照系统时区与 UTC 之间时区偏移进行转换。当前的系统时区是 <code>Etc/UTC</code> 因此创建时间 <code>&#39;2024-05-23 20:17:25&#39;</code> 被当作 UTC 时区的时间 <code>&#39;2024-05-23 20:17:25+00&#39;</code>，然后计算和 1970-01-01 00:00:00 UTC 之间的秒数 1716495445 进行存储。</p>
<img src="/2024/05/24/the-timestamp-in-postgresql/convert-create-time.png" class="">

<p>这是完全按照上面描述的逻辑进行的转换，因为当前的时区就是 Etc&#x2F;UTC，所以结果看起来没什么问题。我们来尝试一个不同的时区，把服务器的时区需改为 UTC+9（东九区）后再来看看这个转换逻辑是否正确。因为我们当前在 UTC+8（东八区）时区，为了避免我们自己所在的时区对转换逻辑的干扰，所以选择设置为 UTC+9 时区。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sed -i <span class="string">&quot;s/timezone = &#x27;Etc\/UTC&#x27;/timezone = &#x27;Asia\/Tokyo&#x27;/&quot;</span> /var/lib/postgresql/data/postgresql.conf</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># cat /var/lib/postgresql/data/postgresql.conf | grep ^timezone</span></span></span><br><span class="line">timezone = &#x27;Asia/Tokyo&#x27;</span><br></pre></td></tr></table></figure>

<p>重启服务器后再写入一条标签名称为 bbb 的记录，写入记录的语句除了标签名称不一样其他都一样</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">SHOW</span> <span class="type">TIME</span> ZONE;</span><br><span class="line">  TimeZone</span><br><span class="line"><span class="comment">------------</span></span><br><span class="line"> Asia<span class="operator">/</span>Tokyo</span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br><span class="line"></span><br><span class="line">test<span class="operator">=</span># <span class="keyword">INSERT INTO</span> label(name, create_time, update_time) <span class="keyword">VALUES</span> (<span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;2024-05-23 20:17:25&#x27;</span>, <span class="string">&#x27;2024-05-23 20:17:25+08&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>按照上面描述的逻辑我们来进行转换，目前当前时区是 Asia&#x2F;Tokyo，<code>&#39;2024-05-23 20:17:25&#39;</code> 被当作 UCT+9 时区的时间 <code>&#39;2024-05-23 20:17:25+09&#39;</code>，然后计算和 1970-01-01 00:00:00 UTC 之间的秒数 1716463045 进行存储。</p>
<img src="/2024/05/24/the-timestamp-in-postgresql/convert-create-time-tokyo.png" class="">

<p>然而这与我们实际查询出来的数据不一样，标签 bbb 的创建时间（在 UTC+9 时区时写入）与标签 aaa 的创建时间（在 UTC+0 时区时写入）是一样的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">SELECT</span> id, name, create_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> create_time) <span class="keyword">AS</span> create_time_epoch, update_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> update_time) <span class="keyword">AS</span> update_time_epoch <span class="keyword">FROM</span> label;</span><br><span class="line"> id <span class="operator">|</span> name <span class="operator">|</span>     create_time     <span class="operator">|</span> create_time_epoch <span class="operator">|</span>      update_time       <span class="operator">|</span> update_time_epoch</span><br><span class="line"><span class="comment">----+------+---------------------+-------------------+------------------------+-------------------</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> aaa  <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span> <span class="operator">|</span>        <span class="number">1716495445</span> <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">17</span>:<span class="number">25</span><span class="operator">+</span><span class="number">09</span> <span class="operator">|</span>        <span class="number">1716466645</span></span><br><span class="line">  <span class="number">2</span> <span class="operator">|</span> bbb  <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span> <span class="operator">|</span>        <span class="number">1716495445</span> <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">17</span>:<span class="number">25</span><span class="operator">+</span><span class="number">09</span> <span class="operator">|</span>        <span class="number">1716466645</span></span><br><span class="line">(<span class="number">2</span> <span class="keyword">rows</span>)</span><br></pre></td></tr></table></figure>

<p>到底哪里出了问题呢？通过分析发现我们受到了 <code>then it is assumed to be in the time zone indicated by the system’s TimeZone parameter</code> 这句话的误导。实际上，对于 <code>timestamp without time zone</code> 类型 PostgreSQL 不会进行时区转换，它把输入的时间当作 UTC 时间，然后计算和 1970-01-01 00:00:00 UTC 之间的秒数并存储这个秒数。即使输入的时间带有时区信息，比如 <code>&#39;2024-05-23 20:17:25+02&#39;</code>，PostgreSQL 也会忽略掉任何时区信息，只使用输入值的日期和时间部分进行计算</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">test<span class="operator">=</span># <span class="keyword">INSERT INTO</span> label(name, create_time, update_time) <span class="keyword">VALUES</span> (<span class="string">&#x27;ccc&#x27;</span>, <span class="string">&#x27;2024-05-23 20:17:25+02&#x27;</span>, <span class="string">&#x27;2024-05-23 20:17:25+08&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">test<span class="operator">=</span># <span class="keyword">SELECT</span> id, name, create_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> create_time) <span class="keyword">AS</span> create_time_epoch, update_time, <span class="built_in">EXTRACT</span>(EPOCH <span class="keyword">FROM</span> update_time) <span class="keyword">AS</span> update_time_epoch <span class="keyword">FROM</span> label;</span><br><span class="line"> id <span class="operator">|</span> name <span class="operator">|</span>     create_time     <span class="operator">|</span> create_time_epoch <span class="operator">|</span>      update_time       <span class="operator">|</span> update_time_epoch</span><br><span class="line"><span class="comment">----+------+---------------------+-------------------+------------------------+-------------------</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> aaa  <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span> <span class="operator">|</span>        <span class="number">1716495445</span> <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">17</span>:<span class="number">25</span><span class="operator">+</span><span class="number">09</span> <span class="operator">|</span>        <span class="number">1716466645</span></span><br><span class="line">  <span class="number">2</span> <span class="operator">|</span> bbb  <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span> <span class="operator">|</span>        <span class="number">1716495445</span> <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">17</span>:<span class="number">25</span><span class="operator">+</span><span class="number">09</span> <span class="operator">|</span>        <span class="number">1716466645</span></span><br><span class="line">  <span class="number">3</span> <span class="operator">|</span> ccc  <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">20</span>:<span class="number">17</span>:<span class="number">25</span> <span class="operator">|</span>        <span class="number">1716495445</span> <span class="operator">|</span> <span class="number">2024</span><span class="number">-05</span><span class="number">-23</span> <span class="number">21</span>:<span class="number">17</span>:<span class="number">25</span><span class="operator">+</span><span class="number">09</span> <span class="operator">|</span>        <span class="number">1716466645</span></span><br><span class="line">(<span class="number">3</span> <span class="keyword">rows</span>)</span><br></pre></td></tr></table></figure>

<p>只有把输入的时间忽略掉任何时区信息并把它当作 UTC 时间才能保证当修改服务器或者客户端的时区时，存储在 <code>timestamp without time zone</code> 类型里的时间才不会改变，才能保证在任何时区下显示的值就是输入的值。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/12/datatype-datetime.html">8.5. Date&#x2F;Time Types</a></li>
<li><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/12/functions-datetime.html">9.9. Date&#x2F;Time Functions and Operators</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b3cfc0912328">有关于PostgreSQL数据库的TIMESTAMPTZ类型数据（时间戳）</a></li>
<li><a target="_blank" rel="noopener" href="https://nanmu.me/zh-cn/posts/2020/postgresql-date-and-time-data-types-explained/">学会和PostgreSQL的时间数据类型愉快玩耍</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Tom098/article/details/124142635">Postgresql 数据库时区(timezone)设置，以及TIMESTAMPTZ和TIMESTAMP数据类型的选择</a></li>
<li><a target="_blank" rel="noopener" href="https://www.rockdata.net/zh-cn/tutorial/type-timestamp/">PostgreSQL 教程: timestamp 时间戳数据类型</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/personblog/p/11126299.html">PostgreSQL TIMESTAMP类型 时间戳</a></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/PostgreSQL/" rel="tag"># PostgreSQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/05/18/determine-whether-the-two-intervals-overlap/" rel="prev" title="判断两个区间是否重叠">
                  <i class="fa fa-angle-left"></i> 判断两个区间是否重叠
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/08/31/optional-condition-in-postgresql-function/" rel="next" title="在 PostgreSQL 函数中使用可选条件">
                  在 PostgreSQL 函数中使用可选条件 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">逗号</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
