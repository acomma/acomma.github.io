<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msvalidate.01" content="09940DFE4C5DA4E85A7117EF7EEC3933">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"acomma.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="看雪论坛 0xEEEE 在逆向调用QQ截图NT与WeChatOCR这篇文章中发布了调用新版 QQ 截图功能的软件 QQScreenShotNT-Plus，虽然已经设置了 QQScreenshot.exe 的路径，但是每次启动这个软件都要提示是否重新自动获取，在设置中去掉“启动提示”依然无效。在那篇文章中作者说 QQScreenShotNT-Plus 是在 QQImpl 基础上实现的，但是作者没有发">
<meta property="og:type" content="article">
<meta property="og:title" content="QQ 截图启动器">
<meta property="og:url" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/index.html">
<meta property="og:site_name" content="逗号的博客">
<meta property="og:description" content="看雪论坛 0xEEEE 在逆向调用QQ截图NT与WeChatOCR这篇文章中发布了调用新版 QQ 截图功能的软件 QQScreenShotNT-Plus，虽然已经设置了 QQScreenshot.exe 的路径，但是每次启动这个软件都要提示是否重新自动获取，在设置中去掉“启动提示”依然无效。在那篇文章中作者说 QQScreenShotNT-Plus 是在 QQImpl 基础上实现的，但是作者没有发">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/create-solution-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/create-solution-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/create-solution-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/git-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/git-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/create-project-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/create-project-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/create-project-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/create-project-4.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/add-icon-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/add-icon-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/add-icon-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/add-icon-4.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/add-icon-5.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/add-icon-6.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/add-icon-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/application-icon-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/application-icon-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/application-icon-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/controls-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/controls-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/notify-icon-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/application-icon-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/notify-icon-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/notify-icon-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/context-menu-item-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/context-menu-item-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/context-menu-item-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/context-menu-item-4.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/context-menu-item-5.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/context-menu-item-6.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form1-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/context-menu-item-action-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/context-menu-item-action-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-4.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-5.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-6.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/config-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/config-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/config-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-7.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/form2-8.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dll-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dll-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dumpbin-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dll-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dll-4.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dll-5.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dll-6.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dll-7.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dll-8.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/dll-9.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/create-project-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/wrapper-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/wrapper-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/wrapper-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/wrapper-4.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/wrapper-5.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/wrapper-6.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/wrapper-7.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/wrapper-8.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/shot-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/shot-2.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/add-icon-1.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/shot-3.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/shot-4.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/shot-5.png">
<meta property="og:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/shot-6.png">
<meta property="article:published_time" content="2025-03-29T11:42:58.000Z">
<meta property="article:modified_time" content="2025-03-29T11:42:58.000Z">
<meta property="article:author" content="逗号">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="WinForms">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/create-solution-1.png">


<link rel="canonical" href="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/","path":"2025/03/29/qq-screen-shot-launcher/","title":"QQ 截图启动器"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>QQ 截图启动器 | 逗号的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">逗号的博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">这里有一句格言，但我还没想好</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.</span> <span class="nav-text">创建解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Git-%E4%BB%93%E5%BA%93"><span class="nav-number">2.</span> <span class="nav-text">创建 Git 仓库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%9B%BE%E6%A0%87%E8%B5%84%E6%BA%90"><span class="nav-number">4.</span> <span class="nav-text">添加图标资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%9B%BE%E6%A0%87"><span class="nav-number">5.</span> <span class="nav-text">设置应用程序图标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%B3%BB%E7%BB%9F%E6%89%98%E7%9B%98%E5%92%8C%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95"><span class="nav-number">6.</span> <span class="nav-text">添加系统托盘和右键菜单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-NotifyIcon-%E5%92%8C-ContextMenuStrip-%E6%8E%A7%E4%BB%B6"><span class="nav-number">6.1.</span> <span class="nav-text">添加 NotifyIcon 和 ContextMenuStrip 控件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-NotifyIcon-%E5%9B%BE%E6%A0%87"><span class="nav-number">6.2.</span> <span class="nav-text">配置 NotifyIcon 图标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-NotifyIcon-%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95"><span class="nav-number">6.3.</span> <span class="nav-text">配置 NotifyIcon 右键菜单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-NotifyIcon-%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7"><span class="nav-number">6.4.</span> <span class="nav-text">配置 NotifyIcon 其他属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95%E9%A1%B9"><span class="nav-number">6.5.</span> <span class="nav-text">添加右键菜单项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8F%AA%E6%98%BE%E7%A4%BA%E6%89%98%E7%9B%98%E5%9B%BE%E6%A0%87"><span class="nav-number">6.6.</span> <span class="nav-text">使应用程序只显示托盘图标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%89%98%E7%9B%98%E9%80%80%E5%87%BA%E4%BA%8B%E4%BB%B6"><span class="nav-number">6.7.</span> <span class="nav-text">添加托盘退出事件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%AE%BE%E7%BD%AE%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="nav-number">7.</span> <span class="nav-text">添加设置对话框</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E8%AE%BE%E7%BD%AE%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="nav-number">7.1.</span> <span class="nav-text">新增设置对话框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E8%AE%BE%E7%BD%AE%E8%8F%9C%E5%8D%95%E9%A1%B9%E6%98%BE%E7%A4%BA%E8%AE%BE%E7%BD%AE%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="nav-number">7.2.</span> <span class="nav-text">点击设置菜单项显示设置对话框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%AE%BE%E7%BD%AE%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%A0%B7%E5%BC%8F"><span class="nav-number">7.3.</span> <span class="nav-text">配置设置对话框样式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%AF%B9%E8%AF%9D%E6%A1%86%E5%90%AF%E5%8A%A8%E4%BD%8D%E7%BD%AE%E5%9C%A8%E5%B1%8F%E5%B9%95%E5%8F%B3%E4%B8%8B%E8%A7%92"><span class="nav-number">7.4.</span> <span class="nav-text">设置对话框启动位置在屏幕右下角</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="nav-number">8.</span> <span class="nav-text">绘制对话框</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">9.</span> <span class="nav-text">创建配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">10.</span> <span class="nav-text">读写配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="nav-number">10.1.</span> <span class="nav-text">添加配置类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%AF%BB%E5%86%99%E9%85%8D%E7%BD%AE%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-number">10.2.</span> <span class="nav-text">添加读写配置的工具类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">10.3.</span> <span class="nav-text">读取配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E5%85%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">10.4.</span> <span class="nav-text">写入配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%8A%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E4%BC%A0%E9%80%92%E7%BB%99%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="nav-number">10.4.1.</span> <span class="nav-text">把配置信息传递给对话框</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%8A%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E4%BC%A0%E9%80%92%E7%BB%99%E4%B8%BB%E7%AA%97%E5%8F%A3"><span class="nav-number">10.4.2.</span> <span class="nav-text">把配置信息传递给主窗口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E5%AF%B9%E8%AF%9D%E6%A1%86%E7%9A%84%E5%8F%96%E6%B6%88%E6%8C%89%E9%92%AE%E6%B7%BB%E5%8A%A0%E4%BA%8B%E4%BB%B6"><span class="nav-number">10.4.3.</span> <span class="nav-text">为对话框的取消按钮添加事件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-QQImpl-%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="nav-number">11.</span> <span class="nav-text">添加 QQImpl 动态链接库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-QQImpl-%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="nav-number">12.</span> <span class="nav-text">编译 QQImpl 动态链接库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%85%E8%A3%85-QQImpl-%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="nav-number">13.</span> <span class="nav-text">包装 QQImpl 动态链接库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="nav-number">13.1.</span> <span class="nav-text">创建动态链接库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-h-%E5%92%8C-lib-%E6%96%87%E4%BB%B6"><span class="nav-number">13.2.</span> <span class="nav-text">添加 .h 和 .lib 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93%E5%8C%85%E8%A3%85"><span class="nav-number">13.3.</span> <span class="nav-text">添加动态链接库包装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-QQ-%E6%88%AA%E5%9B%BE%E5%8A%9F%E8%83%BD"><span class="nav-number">14.</span> <span class="nav-text">实现 QQ 截图功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96"><span class="nav-number">14.1.</span> <span class="nav-text">添加项目依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93%E5%8C%85%E8%A3%85"><span class="nav-number">14.2.</span> <span class="nav-text">实现动态链接库包装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-IPC-%E5%9B%9E%E8%B0%83"><span class="nav-number">14.3.</span> <span class="nav-text">定义 IPC 回调</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-QQ-%E6%88%AA%E5%9B%BE%E8%BF%9B%E7%A8%8B"><span class="nav-number">14.4.</span> <span class="nav-text">初始化 QQ 截图进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E6%89%98%E7%9B%98%E5%9B%BE%E6%A0%87%E5%BC%80%E5%90%AF%E6%88%AA%E5%9B%BE"><span class="nav-number">14.5.</span> <span class="nav-text">点击托盘图标开启截图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%80%E5%87%BA%E5%BA%94%E7%94%A8%E6%97%B6%E7%BB%93%E6%9D%9F%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="nav-number">14.6.</span> <span class="nav-text">退出应用时结束子进程</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">逗号</p>
  <div class="site-description" itemprop="description">这里是站点描述，但我没有写</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/acomma" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;acomma" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:acomma@yeah.net" title="E-Mail → mailto:acomma@yeah.net" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://acomma.github.io/2025/03/29/qq-screen-shot-launcher/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="逗号">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="逗号的博客">
      <meta itemprop="description" content="这里是站点描述，但我没有写">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="QQ 截图启动器 | 逗号的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          QQ 截图启动器
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-29 19:42:58" itemprop="dateCreated datePublished" datetime="2025-03-29T19:42:58+08:00">2025-03-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/">看雪</a>论坛 <a target="_blank" rel="noopener" href="https://bbs.kanxue.com/homepage-901761.htm">0xEEEE</a> 在<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-278161.htm">逆向调用QQ截图NT与WeChatOCR</a>这篇文章中发布了调用新版 QQ 截图功能的软件 <em>QQScreenShotNT-Plus</em>，虽然已经设置了 <em>QQScreenshot.exe</em> 的路径，但是每次启动这个软件都要提示是否重新自动获取，在设置中去掉“启动提示”依然无效。在那篇文章中作者说 <em>QQScreenShotNT-Plus</em> 是在 <a target="_blank" rel="noopener" href="https://github.com/EEEEhex/QQImpl">QQImpl</a> 基础上实现的，但是作者没有发布对应的源代码，因此我准备基于 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/?view=netdesktop-8.0">Windows Forms</a> 技术复刻相关的功能。因为是第一次使用 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/">.NET</a> 相关技术开发 Windows 系统的应用软件，所以会详细地记录整个开发过程。源代码在 <a target="_blank" rel="noopener" href="https://github.com/acomma/QQScreenShotLauncher">QQScreenShotLauncher</a>。</p>
<span id="more"></span>

<h2 id="创建解决方案"><a href="#创建解决方案" class="headerlink" title="创建解决方案"></a>创建解决方案</h2><p>这部分内容参考<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/visualstudio/get-started/tutorial-projects-solutions?view=vs-2022">项目和解决方案简介</a>。启动 Visual Studio 2022，在 <em>Visual Studio 2022</em> 对话框选择 <em>Create a new project</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/create-solution-1.png" class="">

<p>在 <em>Create a new project</em> 对话框的在搜索框输入 <em>solution</em>，选择<em>语言</em>、<em>平台</em>、<em>项目类型</em>，然后选择 <em>Blank Solution</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/create-solution-2.png" class="">

<p>在 <em>Configure your new project</em> 对话框输入解决方案名称 <em>QQScreenShotLauncher</em>，保存位置 <em>D:\projects\dotnet\</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/create-solution-3.png" class="">

<h2 id="创建-Git-仓库"><a href="#创建-Git-仓库" class="headerlink" title="创建 Git 仓库"></a>创建 Git 仓库</h2><p>这部分内容参考<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/visualstudio/version-control/git-create-repository?view=vs-2022">从 Visual Studio 创建 Git 存储库</a>。在 Git 变更选择 <em>Create Git Repository</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/git-1.png" class="">

<p>在 <em>Create a Git repository</em> 对话框选择 <em>Local only</em>，<em>Local path</em>、<em>.gitignore template</em>、<em>License template</em> 三项使用默认值，勾选 <em>Add a README.md</em> 复选框</p>
<img src="/2025/03/29/qq-screen-shot-launcher/git-2.png" class="">

<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>这部分内容参考<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/visualstudio/get-started/tutorial-projects-solutions?view=vs-2022">项目和解决方案简介</a>。在<em>解决方案资源管理器</em>中，右键单击 <em>QQScreenShotLauncher</em> 解决方案，依次选择 <em>Add</em> 和 <em>New Project</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/create-project-1.png" class="">

<p>在搜索框输入 <em>Windows Forms App</em>，选择<em>语言</em>、<em>平台</em>、<em>项目类型</em>，然后选择 <em>Windows Forms App</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/create-project-2.png" class="">

<p>在 <em>Configure your new project</em> 对话框输入项目名称 <em>NTLauncher</em>，保存位置保持默认值</p>
<img src="/2025/03/29/qq-screen-shot-launcher/create-project-3.png" class="">

<p>在 <em>Additional information</em> 对话框选择框架版本 <em>.NET 8.0 (Long Term Support)</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/create-project-4.png" class="">

<h2 id="添加图标资源"><a href="#添加图标资源" class="headerlink" title="添加图标资源"></a>添加图标资源</h2><p>这部分参考<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/visualstudio/ide/managing-application-resources-dotnet?view=vs-2022">管理应用程序资源</a>。在<em>解决方案资源管理器</em>中，右键单击 <em>NTLauncher</em> 项目，选择 <em>Properties</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/add-icon-1.png" class="">

<p>选中 <em>Resources &gt; General</em>，点击 <em>Create or open assembly resources</em> 链接</p>
<img src="/2025/03/29/qq-screen-shot-launcher/add-icon-2.png" class="">

<p>在 <em>Resource Explorer</em> 点击<em>加号</em>按钮</p>
<img src="/2025/03/29/qq-screen-shot-launcher/add-icon-3.png" class="">

<p>在 <em>Add a new resource</em> 对话框，<em>Type</em> 下拉框选择 <em>Icon</em>，其他保持默认，然后点击 <em>Add existing file</em> 按钮</p>
<img src="/2025/03/29/qq-screen-shot-launcher/add-icon-4.png" class="">

<p>在文件选择对话框中选择 <em>NTLauncher.ico</em>（这个文件来自 <a target="_blank" rel="noopener" href="https://bbs.kanxue.com/homepage-901761.htm">0xEEEE</a> 在<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-278161.htm">逆向调用QQ截图NT与WeChatOCR</a> 提供的 <em>QQScreenShotNT-Lite.zip</em> 压缩包）</p>
<img src="/2025/03/29/qq-screen-shot-launcher/add-icon-5.png" class="">

<p>在 <em>Add a new resource</em> 对话框，<em>Neutral value</em> 就是刚刚选择的文件，<em>Store as</em> 下拉框选择 <em>System.Drawing.Icon (Windows Forms)</em>，其他保持默认</p>
<img src="/2025/03/29/qq-screen-shot-launcher/add-icon-6.png" class="">

<h2 id="设置应用程序图标"><a href="#设置应用程序图标" class="headerlink" title="设置应用程序图标"></a>设置应用程序图标</h2><p>这部分参考<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/visualstudio/ide/how-to-specify-an-application-icon-visual-basic-csharp?view=vs-2022">指定应用程序图标 （Visual Basic， C#）</a>。在<em>解决方案资源管理器</em>中，右键单击 <em>NTLauncher</em> 项目，选择 <em>Properties</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/add-icon-1.png" class="">

<p>选中 <em>Application &gt; Win32 Resources</em>，点击 <em>Browse</em> 按钮</p>
<img src="/2025/03/29/qq-screen-shot-launcher/application-icon-1.png" class="">

<p>在文件选择对话框中选择 <em>NTLauncher.ico</em>，注意选择文件所在的目录，这个文件是上一步<em>添加图标资源</em>添加到项目的 <em>Resources</em> 目录的</p>
<img src="/2025/03/29/qq-screen-shot-launcher/application-icon-2.png" class="">

<p>文件选择完成后 <em>Icon</em> 项的值为 <em>Resources\NTLauncher.ico</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/application-icon-3.png" class="">

<h2 id="添加系统托盘和右键菜单"><a href="#添加系统托盘和右键菜单" class="headerlink" title="添加系统托盘和右键菜单"></a>添加系统托盘和右键菜单</h2><p>这部分主要参考了以下资料</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/notifyicon-component-overview-windows-forms?view=netframeworkdesktop-4.8">NotifyIcon 组件概述（Windows 窗体）</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/app-icons-to-the-taskbar-with-wf-notifyicon?view=netframeworkdesktop-4.8">如何使用 Windows 窗体 (Windows Forms) NotifyIcon 组件向任务栏添加应用程序图标</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/how-to-associate-a-shortcut-menu-with-a-windows-forms-notifyicon-component?view=netframeworkdesktop-4.8">如何：将快捷菜单与 Windows 窗体 NotifyIcon 组件相关联</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/how-to-associate-a-contextmenustrip-with-a-control?view=netframeworkdesktop-4.8">如何将 ContextMenuStrip 与控件关联</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/how-to-add-menu-items-to-a-contextmenustrip?view=netframeworkdesktop-4.8">如何：向 ContextMenuStrip 添加菜单项</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/api/system.windows.forms.notifyicon?view=windowsdesktop-8.0">NotifyIcon 类</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/api/system.windows.forms.contextmenustrip?view=windowsdesktop-8.0">ContextMenuStrip 类</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mingupupu/p/18022142">winform实现最小化至系统托盘</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/vipsoft/p/18665897">C#实现 Winform 程序在系统托盘显示图标 &amp; 开机自启动</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/zz81238919/article/details/136168347">WinForm窗体隐藏任务栏图标和系统托盘显示图标</a></li>
</ol>
<h3 id="添加-NotifyIcon-和-ContextMenuStrip-控件"><a href="#添加-NotifyIcon-和-ContextMenuStrip-控件" class="headerlink" title="添加 NotifyIcon 和 ContextMenuStrip 控件"></a>添加 NotifyIcon 和 ContextMenuStrip 控件</h3><p>在 <em>Toolbox</em> 搜索 <em>NotifyIcon</em>，将 <em>NotifyIcon</em> 控件拖入 <em>Form1</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/controls-1.png" class="">

<p>对 <em>ContextMenuStrip</em> 控件进行类似的操作，控件添加完成后</p>
<img src="/2025/03/29/qq-screen-shot-launcher/controls-2.png" class="">

<h3 id="配置-NotifyIcon-图标"><a href="#配置-NotifyIcon-图标" class="headerlink" title="配置 NotifyIcon 图标"></a>配置 NotifyIcon 图标</h3><p>选中 <em>notifyIcon1</em> 控件，在 <em>Properties</em> 找到 <em>Appearance &gt; Icon</em>，点击右侧 <em>…</em> 按钮</p>
<img src="/2025/03/29/qq-screen-shot-launcher/notify-icon-1.png" class="">

<p>在文件选择对话框中选择 <em>NTLauncher.ico</em>，注意选择文件所在的目录，这个文件是在<em>添加图标资源</em>添加到项目的 <em>Resources</em> 目录的</p>
<img src="/2025/03/29/qq-screen-shot-launcher/application-icon-2.png" class="">

<h3 id="配置-NotifyIcon-右键菜单"><a href="#配置-NotifyIcon-右键菜单" class="headerlink" title="配置 NotifyIcon 右键菜单"></a>配置 NotifyIcon 右键菜单</h3><p>选中 <em>notifyIcon1</em> 控件，在 <em>Properties</em> 找到 <em>Behavior &gt; ContextMenuStrip</em>，在右侧下来选项中选择 <em>contextMenuStrip1</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/notify-icon-2.png" class="">

<h3 id="配置-NotifyIcon-其他属性"><a href="#配置-NotifyIcon-其他属性" class="headerlink" title="配置 NotifyIcon 其他属性"></a>配置 NotifyIcon 其他属性</h3><p>选中 <em>notifyIcon1</em> 控件，配置 <em>Appearance &gt; Text</em> 为 <em>NTLauncher</em>，配置 <em>Behavior &gt; Visible</em> 为 <em>True</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/notify-icon-3.png" class="">

<p><em>notifyIcon1</em> 的 <em>Visible</em> 配合 <em>Form1</em> 的 <em>ShowInTaskbar</em> 和 <em>WindowState</em> 就可以实现启动应用程序只显示托盘图标的功能。</p>
<h3 id="添加右键菜单项"><a href="#添加右键菜单项" class="headerlink" title="添加右键菜单项"></a>添加右键菜单项</h3><p>选中 <em>contextMenuStrip1</em> 控件，点击右上角三角形图标，在弹出的 <em>ContextMenuStrip Tasks</em> 中点击 <em>Edit Items</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/context-menu-item-1.png" class="">

<p>在 <em>Items Collection Editor</em> 对话框选中 <em>contextMenuStrip1</em> 成员，选择 <em>MenuItem</em>，点击 <em>Add</em> 按钮添加菜单项</p>
<img src="/2025/03/29/qq-screen-shot-launcher/context-menu-item-2.png" class="">

<p>在 <em>Items Collection Editor</em> 对话框选中 <em>contextMenuStrip1</em> 成员，选择 <em>Separator</em>，点击 <em>Add</em> 按钮添加分割线</p>
<img src="/2025/03/29/qq-screen-shot-launcher/context-menu-item-3.png" class="">

<p>我们将添加 7 个菜单项，3 条分割线，通过右侧的功能按钮<em>排序</em>或<em>删除</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/context-menu-item-4.png" class="">

<p>选中 <em>toolStripMenuItem1</em>，修改 <em>Appearance &gt; Text</em> 的值为<em>关于</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/context-menu-item-5.png" class="">

<p>对其他菜单项进行类似操作，编辑完成后的 <em>Form1</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/context-menu-item-6.png" class="">

<h3 id="使应用程序只显示托盘图标"><a href="#使应用程序只显示托盘图标" class="headerlink" title="使应用程序只显示托盘图标"></a>使应用程序只显示托盘图标</h3><p>选中 <em>Form1</em> 控件，设置 <em>Layout &gt; WindowState</em> 为 <em>Minimized</em>，设置 <em>Window Style &gt; ShowInTaskbar</em> 为 <em>False</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/form1-1.png" class="">

<h3 id="添加托盘退出事件"><a href="#添加托盘退出事件" class="headerlink" title="添加托盘退出事件"></a>添加托盘退出事件</h3><p>选中 <em>contextMenuStrip1</em> 控件，然后选中<em>退出</em>菜单项，配置 <em>Action &gt; Click</em> 为 <em>toolStripMenuItem7_Click</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/context-menu-item-action-1.png" class="">

<p>上面的操作会自动在 <code>Form1.cs</code> 中创建函数 <code>toolStripMenuItem7_Click</code>，其实现为</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toolStripMenuItem7_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Application.Exit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加设置对话框"><a href="#添加设置对话框" class="headerlink" title="添加设置对话框"></a>添加设置对话框</h2><p>这部分内容主要参考了以下资料</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/baissy/p/12689287.html">C# Winform同一子窗体只允许打开一次</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hanzq/p/16978697.html">WinForm窗体应用——父窗体每次只打开一个子窗体的方法</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_28821897/article/details/121549310">c# WinForm 点击出现弹出多个窗体， 怎么才能只显示一个窗体。解决方案</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43022415/article/details/106667387">C# WinForm 点击按钮显示唯一窗体</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/feiduan1211/article/details/88419561">C#窗体程序（winform）禁止最小化、最大化，或去掉关闭按钮</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/aning2015/p/9268486.html">WinForm 设置窗体启动位置在活动屏幕右下角</a></li>
</ol>
<h3 id="新增设置对话框"><a href="#新增设置对话框" class="headerlink" title="新增设置对话框"></a>新增设置对话框</h3><p>在 <em>NTLauncher</em> 项目上单击右键，在弹出菜单中依次选择 <em>Add &gt; New Items</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-1.png" class="">

<p>在 <em>Add New Item</em> 对话框中选中 <em>Installed &gt; C# Items</em>，在右侧选中 <em>Form (Windows Forms)</em>，注意下方 <em>Name</em> 的值 <em>Form2.cs</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-2.png" class="">

<h3 id="点击设置菜单项显示设置对话框"><a href="#点击设置菜单项显示设置对话框" class="headerlink" title="点击设置菜单项显示设置对话框"></a>点击设置菜单项显示设置对话框</h3><p>在 <em>Form1</em> 选中 <em>contextMenuStrip1</em> 控件，然后选中<em>设置</em>菜单项，配置 <em>Action &gt; Click</em> 为 <em>toolStripMenuItem2_Click</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/context-menu-item-action-2.png" class="">

<p>上面的操作会自动在 <code>Form1.cs</code> 中创建函数 <code>toolStripMenuItem2_Click</code>，其实现为</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Form2? form2 = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toolStripMenuItem2_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (form2 == <span class="literal">null</span> || form2.IsDisposed)</span><br><span class="line">    &#123;</span><br><span class="line">        form2 = <span class="keyword">new</span> Form2();</span><br><span class="line">        form2.FormClosed += (s, _) =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            form2?.Dispose(); <span class="comment">// 显式释放资源</span></span><br><span class="line">            form2 = <span class="literal">null</span>;     <span class="comment">// 强制置空</span></span><br><span class="line">        &#125;;</span><br><span class="line">        form2.ShowDialog();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        form2.Activate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个实现里增加了一个变量 <code>form2</code> 来表示打开的设置对话，对话框关闭时把该变量置空，这保证多次点击<em>设置</em>菜单只打开一个对话框。</p>
<h3 id="配置设置对话框样式"><a href="#配置设置对话框样式" class="headerlink" title="配置设置对话框样式"></a>配置设置对话框样式</h3><p>选中 <em>Form2</em>，设置 <em>Appearance &gt; Text</em> 为 <em>设置</em>，设置 <em>Window Style &gt; MaximizeBox</em> 为 <em>False</em>，设置 <em>Window Style &gt; MinimizeBox</em> 为 <em>False</em>，设置 <em>Window Style &gt; ShowIcon</em> 为 <em>False</em>，设置 <em>Window Style &gt; ShowInTaskbar</em> 为 <em>False</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-3.png" class="">

<h3 id="设置对话框启动位置在屏幕右下角"><a href="#设置对话框启动位置在屏幕右下角" class="headerlink" title="设置对话框启动位置在屏幕右下角"></a>设置对话框启动位置在屏幕右下角</h3><p>选中 <em>Form2</em>，设置 <em>Layout &gt; StartPosition</em> 为 <em>Manual</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-4.png" class="">

<p>在 <code>Form2.cs</code> 中重新计算对话框的位置</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Form2</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    InitializeComponent();</span><br><span class="line"></span><br><span class="line">    Screen screen = Screen.FromPoint(<span class="keyword">new</span> Point(Cursor.Position.X, Cursor.Position.Y));</span><br><span class="line">    <span class="built_in">int</span> x = screen.WorkingArea.X + screen.WorkingArea.Width - <span class="keyword">this</span>.Width;</span><br><span class="line">    <span class="built_in">int</span> y = screen.WorkingArea.Y + screen.WorkingArea.Height - <span class="keyword">this</span>.Height;</span><br><span class="line">    <span class="keyword">this</span>.Location = <span class="keyword">new</span> Point(x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="绘制对话框"><a href="#绘制对话框" class="headerlink" title="绘制对话框"></a>绘制对话框</h2><p>这部分内容主要参考了以下资料</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/get-started/create-app-visual-studio?view=netdesktop-8.0">教程：使用 .NET 创建 Windows 窗体应用</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/visualstudio/get-started/csharp/tutorial-windows-forms-math-quiz-create-project-add-controls?view=vs-2022">教程：创建数学测验 WinForms 应用</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/layout?view=netdesktop-8.0">控件的位置和布局（Windows 窗体 .NET）</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/walkthrough-arranging-controls-on-windows-forms-using-snaplines?view=netframeworkdesktop-4.8">演示：使用捕捉线排列 Windows 窗体上的控件</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/how-to-align-multiple-controls-on-windows-forms?view=netframeworkdesktop-4.8">如何：在 Windows 窗体上对齐多个控件</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/csdn_wuwt/article/details/88222159">Winform禁止调整大小</a></li>
</ol>
<p>主要用到的控件为 <em>GroupBox</em>、<em>CheckBox</em>、<em>Label</em>、<em>TextBox</em>、<em>Button</em>，成品图如下所示</p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-5.png" class="">

<p>选中 <em>Form2</em>，设置 <em>Appearance &gt; FormBorderStyle</em> 为 <em>FixedSingle</em>，禁止改变窗口大小</p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-6.png" class="">

<h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><p>在 <em>NTLauncher</em> 项目上单击右键，在弹出菜单中依次选择 <em>Add &gt; New Items</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-1.png" class="">

<p>在弹出的 <em>Add New Item</em> 对话框中选中 <em>Installed &gt; C# Items &gt; General</em>，然后选中 <em>Text file</em>，修改 <em>Name</em> 处的名称为 <em>config.ini</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/config-1.png" class="">

<p>文件的内容来自 <em>QQScreenShotNT-Plus</em> 的初始配置</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[ExePath]</span></span><br><span class="line"><span class="attr">QQScreenShot</span>=</span><br><span class="line"><span class="attr">UsrLib</span>=</span><br><span class="line"><span class="attr">WeChatOCR</span>=</span><br><span class="line"><span class="attr">WeChatUtility</span>=</span><br><span class="line"><span class="section">[General]</span></span><br><span class="line"><span class="attr">AutoExitClear</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">AutoNTVOpen</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">AutoRun</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">DebugConsole</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">EnableHotKey</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">EnableOCR</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">EnablePlugin</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">EnableScreenShot</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">EnableUtility</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">FisrtRun</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">HotKey</span>=CTRL+ALT+A</span><br><span class="line"><span class="attr">KillXPlugin</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">RunTip</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">ScrollVol</span>=<span class="literal">false</span></span><br><span class="line"><span class="section">[NTViewer]</span></span><br><span class="line"><span class="attr">DbgConsole</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">LaunchShow</span>=<span class="literal">false</span></span><br><span class="line"><span class="section">[Plugin]</span></span><br><span class="line"><span class="attr">CurOCR</span>=NULL</span><br><span class="line"><span class="attr">CurSearch</span>=.\ntplugin\baidusearch.py</span><br><span class="line"><span class="attr">CurSoutu</span>=.\ntplugin\baidusoutu.py</span><br><span class="line"><span class="attr">CurTran</span>=.\ntplugin\youdaotran.py</span><br><span class="line"><span class="attr">PluginDir</span>=.\ntplugin</span><br><span class="line"><span class="attr">PythonDir</span>=.\pyenv</span><br></pre></td></tr></table></figure>

<p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/sd7o95o/article/details/136668458">在 .NET 项目中复制资源文件夹到生成目录</a>，在 <em>Solution Explorer</em> 中选中 <em>config.ini</em> 文件，在 <em>Properties</em> 中修改 <em>Advanced &gt; Copy to Output Directory</em> 为 <em>Copy always</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/config-2.png" class="">

<p>在 Visual Studio 中通过这种方式创建的文件的格式是 <em>UTF-8 with BOM</em>，在使用 <em>kernel32.dll</em> 中的 <code>GetPrivateProfileString</code>、<code>WritePrivateProfileString</code> 读写时无法读写第一节的内容。有两种避免的方式，第一种是参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/congduan/article/details/9324113">C#读写ini配置文件</a> 和 <a target="_blank" rel="noopener" href="https://blog.csdn.net/DLS756/article/details/109082078">INI文件使用时的注意事项</a>让 <em>ini</em> 文件的第一行为空行。第二种是重新创建一个 <em>UTF-8 without BOM</em> 格式的文件。这里选择第三种方式，直接使用 <em>QQScreenShotNT-Plus</em> 中的 <em>config.ini</em> 文件，它是 <em>UTF-8 without BOM</em> 格式的文件。</p>
<h2 id="读写配置文件"><a href="#读写配置文件" class="headerlink" title="读写配置文件"></a>读写配置文件</h2><h3 id="添加配置类"><a href="#添加配置类" class="headerlink" title="添加配置类"></a>添加配置类</h3><p>在 <em>NTLauncher</em> 项目上单击右键，在弹出菜单中依次选择 <em>Add &gt; New Items</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-1.png" class="">

<p>在弹出的 <em>Add New Item</em> 对话框中选中 <em>Installed &gt; C# Items &gt; Code</em>，然后选中 <em>Class</em>，修改 <em>Name</em> 处的名称为 <em>Config.cs</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/config-3.png" class="">

<p><em>Config.cs</em> 文件的内容如下所示，<em>config.ini</em> 中的每一个键对应一个属性</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">NTLauncher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Config</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> QQScreenShot &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> UsrLib &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> WeChatOCR &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> WeChatUtility &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> AutoExitClear &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> AutoNTVOpen &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> AutoRun &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> DebugConsole &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> EnableHotKey &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> EnableOCR &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> EnablePlugin &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> EnableScreenShot &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> EnableUtility &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> FisrtRun &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> HotKey &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> KillXPlugin &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> RunTip &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> ScrollVol &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> DbgConsole &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> LaunchShow &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CurOCR &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CurSearch &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CurSoutu &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CurTran &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> PluginDir &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> PythonDir &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加读写配置的工具类"><a href="#添加读写配置的工具类" class="headerlink" title="添加读写配置的工具类"></a>添加读写配置的工具类</h3><p>这部分内容参考以下资料</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45499836/article/details/118353614">C# 读写编辑INI文件-完整详细版</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/falcon-fei/p/9849868.html">c# winform程序读写ini配置文件</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fireicesion/p/16809687.html">.NET(C#)读写ini配置文件的方法及示例代码</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46086778/article/details/137241827">C#读取写入ini配置文件-以winform为例</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/csharp/fundamentals/tutorials/classes">使用类和对象探索面向对象的编程</a></li>
</ol>
<p>使用 <em>kernel32.dll</em> 中的 <code>GetPrivateProfileString</code>、<code>WritePrivateProfileString</code> 方法读写 <em>config</em> 配置文件</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">NTLauncher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConfigHandler</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> filePath;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">long</span> <span class="title">WritePrivateProfileString</span>(<span class="params"><span class="built_in">string</span> section, <span class="built_in">string</span> key, <span class="built_in">string</span> val, <span class="built_in">string</span> filePath</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;kernel32.dll&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">int</span> <span class="title">GetPrivateProfileString</span>(<span class="params"><span class="built_in">string</span> section, <span class="built_in">string</span> key, <span class="built_in">string</span> defVal, StringBuilder retVal, <span class="built_in">int</span> size, <span class="built_in">string</span> filePath</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ConfigHandler</span>(<span class="params"><span class="built_in">string</span> filePath</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.filePath = filePath;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Write</span>(<span class="params">Config config</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// ExePath</span></span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;ExePath&quot;</span>, <span class="string">&quot;QQScreenShot&quot;</span>, config.QQScreenShot, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;ExePath&quot;</span>, <span class="string">&quot;UsrLib&quot;</span>, config.UsrLib, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;ExePath&quot;</span>, <span class="string">&quot;WeChatOCR&quot;</span>, config.WeChatOCR, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;ExePath&quot;</span>, <span class="string">&quot;WeChatUtility&quot;</span>, config.WeChatUtility, <span class="keyword">this</span>.filePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// General</span></span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;AutoExitClear&quot;</span>, config.AutoExitClear, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;AutoNTVOpen&quot;</span>, config.AutoNTVOpen, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;AutoRun&quot;</span>, config.AutoRun, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;DebugConsole&quot;</span>, config.DebugConsole, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnableHotKey&quot;</span>, config.EnableHotKey, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnableOCR&quot;</span>, config.EnableOCR, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnablePlugin&quot;</span>, config.EnablePlugin, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnableScreenShot&quot;</span>, config.EnableScreenShot, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnableUtility&quot;</span>, config.EnableUtility, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;FisrtRun&quot;</span>, config.FisrtRun, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;HotKey&quot;</span>, config.HotKey, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;KillXPlugin&quot;</span>, config.KillXPlugin, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;RunTip&quot;</span>, config.RunTip, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;ScrollVol&quot;</span>, config.ScrollVol, <span class="keyword">this</span>.filePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// NTViewer</span></span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;NTViewer&quot;</span>, <span class="string">&quot;DbgConsole&quot;</span>, config.DbgConsole, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;NTViewer&quot;</span>, <span class="string">&quot;LaunchShow&quot;</span>, config.LaunchShow, <span class="keyword">this</span>.filePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Plugin</span></span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;CurOCR&quot;</span>, config.CurOCR, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;CurSearch&quot;</span>, config.CurSearch, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;CurSoutu&quot;</span>, config.CurSoutu, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;CurTran&quot;</span>, config.CurTran, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;PluginDir&quot;</span>, config.PluginDir, <span class="keyword">this</span>.filePath);</span><br><span class="line">            WritePrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;PythonDir&quot;</span>, config.PythonDir, <span class="keyword">this</span>.filePath);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Config <span class="title">Read</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Config config = <span class="keyword">new</span> Config();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ExePath</span></span><br><span class="line"></span><br><span class="line">            StringBuilder retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;ExePath&quot;</span>, <span class="string">&quot;QQScreenShot&quot;</span>, <span class="string">&quot;&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.QQScreenShot = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;ExePath&quot;</span>, <span class="string">&quot;UsrLib&quot;</span>, <span class="string">&quot;&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.UsrLib = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;ExePath&quot;</span>, <span class="string">&quot;WeChatOCR&quot;</span>, <span class="string">&quot;&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.WeChatOCR = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;ExePath&quot;</span>, <span class="string">&quot;WeChatUtility&quot;</span>, <span class="string">&quot;&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.WeChatUtility = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// General</span></span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;AutoExitClear&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.AutoExitClear = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;AutoNTVOpen&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.AutoNTVOpen = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;AutoRun&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.AutoRun = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;DebugConsole&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.DebugConsole = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnableHotKey&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.EnableHotKey = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnableOCR&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.EnableOCR = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnablePlugin&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.EnablePlugin = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnableScreenShot&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.EnableScreenShot = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;EnableUtility&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.EnableUtility = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;FisrtRun&quot;</span>, <span class="string">&quot;true&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.FisrtRun = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;HotKey&quot;</span>, <span class="string">&quot;CTRL+ALT+A&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.HotKey = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;KillXPlugin&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.KillXPlugin = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;RunTip&quot;</span>, <span class="string">&quot;true&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.RunTip = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;General&quot;</span>, <span class="string">&quot;ScrollVol&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.ScrollVol = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// NTViewer</span></span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;NTViewer&quot;</span>, <span class="string">&quot;DbgConsole&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.DbgConsole = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;NTViewer&quot;</span>, <span class="string">&quot;LaunchShow&quot;</span>, <span class="string">&quot;false&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.LaunchShow = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Plugin</span></span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;CurOCR&quot;</span>, <span class="string">&quot;NULL&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.CurOCR = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;CurSearch&quot;</span>, <span class="string">&quot;.\\ntplugin\\baidusearch.py&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.CurSearch = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;CurSoutu&quot;</span>, <span class="string">&quot;.\\ntplugin\\baidusoutu.py&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.CurSoutu = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;CurTran&quot;</span>, <span class="string">&quot;.\\ntplugin\\youdaotran.py&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.CurTran = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;PluginDir&quot;</span>, <span class="string">&quot;.\\ntplugin&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.PluginDir = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            retVal = <span class="keyword">new</span> StringBuilder(<span class="number">255</span>);</span><br><span class="line">            GetPrivateProfileString(<span class="string">&quot;Plugin&quot;</span>, <span class="string">&quot;PythonDir&quot;</span>, <span class="string">&quot;.\\pyenv&quot;</span>, retVal, <span class="number">255</span>, <span class="keyword">this</span>.filePath);</span><br><span class="line">            config.PythonDir = retVal.ToString();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> config;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="读取配置文件"><a href="#读取配置文件" class="headerlink" title="读取配置文件"></a>读取配置文件</h3><p>在 <em>Form1.cs</em> 的构造方法中读取配置文件并保存到全局变量中</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ConfigHandler handler;</span><br><span class="line"><span class="keyword">private</span> Config config;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Form1</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    InitializeComponent();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.handler = <span class="keyword">new</span> ConfigHandler(Application.StartupPath + <span class="string">&quot;config.ini&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.config = <span class="keyword">this</span>.handler.Read();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="写入配置文件"><a href="#写入配置文件" class="headerlink" title="写入配置文件"></a>写入配置文件</h3><p>这部内容参考以下资料</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/HerryDong/article/details/103004234">WinForm中父窗体与子窗体之间的相互传值</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhangshengrong.com/p/v710KqRyXM/">C#开发Winform实现窗体间相互传值</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xh6300/p/6063649.html">C#跨窗体传值的几种方法分析（很详细）</a></li>
</ol>
<h4 id="把配置信息传递给对话框"><a href="#把配置信息传递给对话框" class="headerlink" title="把配置信息传递给对话框"></a>把配置信息传递给对话框</h4><p>通过构造函数把配置信息传递给对话框。改造 <em>Form2.cs</em> 的构造函数，增加 <code>Config config</code> 参数，在构造函数里为表单项赋值</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Config config;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Form2</span>(<span class="params">Config config</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    InitializeComponent();</span><br><span class="line"></span><br><span class="line">    Screen screen = Screen.FromPoint(<span class="keyword">new</span> Point(Cursor.Position.X, Cursor.Position.Y));</span><br><span class="line">    <span class="built_in">int</span> x = screen.WorkingArea.X + screen.WorkingArea.Width - <span class="keyword">this</span>.Width;</span><br><span class="line">    <span class="built_in">int</span> y = screen.WorkingArea.Y + screen.WorkingArea.Height - <span class="keyword">this</span>.Height;</span><br><span class="line">    <span class="keyword">this</span>.Location = <span class="keyword">new</span> Point(x, y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.config = config;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.checkBox1.Checked = <span class="keyword">this</span>.config.EnableScreenShot == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox2.Checked = <span class="keyword">this</span>.config.EnableOCR == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox3.Checked = <span class="keyword">this</span>.config.EnableUtility == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox4.Checked = <span class="keyword">this</span>.config.AutoRun == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox5.Checked = <span class="keyword">this</span>.config.ScrollVol == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox6.Checked = <span class="keyword">this</span>.config.RunTip == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox7.Checked = <span class="keyword">this</span>.config.LaunchShow == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox8.Checked = <span class="keyword">this</span>.config.DebugConsole == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox9.Checked = <span class="keyword">this</span>.config.DbgConsole == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox10.Checked = <span class="keyword">this</span>.config.KillXPlugin == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox11.Checked = <span class="keyword">this</span>.config.AutoNTVOpen == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox12.Checked = <span class="keyword">this</span>.config.AutoExitClear == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox13.Checked = <span class="keyword">this</span>.config.EnablePlugin == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.checkBox14.Checked = <span class="keyword">this</span>.config.EnableHotKey == <span class="string">&quot;true&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span>[] hotKey = <span class="keyword">this</span>.config.HotKey.Split(<span class="string">&#x27;+&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.textBox1.Text = <span class="keyword">this</span>.config.QQScreenShot;</span><br><span class="line">    <span class="keyword">this</span>.textBox2.Text = <span class="keyword">this</span>.config.UsrLib;</span><br><span class="line">    <span class="keyword">this</span>.textBox3.Text = <span class="keyword">this</span>.config.WeChatOCR;</span><br><span class="line">    <span class="keyword">this</span>.textBox4.Text = <span class="keyword">this</span>.config.WeChatUtility;</span><br><span class="line">    <span class="keyword">this</span>.textBox5.Text = <span class="keyword">this</span>.config.PythonDir;</span><br><span class="line">    <span class="keyword">this</span>.textBox6.Text = <span class="keyword">this</span>.config.PluginDir;</span><br><span class="line">    <span class="keyword">this</span>.textBox7.Text = hotKey[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">this</span>.textBox8.Text = hotKey[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">this</span>.textBox9.Text = hotKey[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在点击<em>设置</em>菜单时把配置传递给对话框，如下面的第 5 行代码</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toolStripMenuItem2_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.form2 == <span class="literal">null</span> || <span class="keyword">this</span>.form2.IsDisposed)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.form2 = <span class="keyword">new</span> Form2(<span class="keyword">this</span>.config);</span><br><span class="line">        <span class="keyword">this</span>.form2.FormClosed += (s, _) =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.form2?.Dispose(); <span class="comment">// 显式释放资源</span></span><br><span class="line">            <span class="keyword">this</span>.form2 = <span class="literal">null</span>;     <span class="comment">// 强制置空</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.form2.ShowDialog();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.form2.Activate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="把配置信息传递给主窗口"><a href="#把配置信息传递给主窗口" class="headerlink" title="把配置信息传递给主窗口"></a>把配置信息传递给主窗口</h4><p>为 <em>Form2</em> 的<em>确定</em>按钮添加点击事件。在 <em>Form2</em> 选中<em>确定</em>按钮，在 <em>Properties</em> 修改 <em>Action &gt; Click</em> 为 <em>button6_Click</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-7.png" class="">

<p>在 <code>button6_Click</code> 方法中收集表单的值并对 <code>this.config</code> 相关属性赋值</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">button6_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.config.EnableScreenShot = <span class="keyword">this</span>.checkBox1.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.EnableOCR = <span class="keyword">this</span>.checkBox2.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.EnableUtility = <span class="keyword">this</span>.checkBox3.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.AutoRun = <span class="keyword">this</span>.checkBox4.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.ScrollVol = <span class="keyword">this</span>.checkBox5.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.RunTip = <span class="keyword">this</span>.checkBox6.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.LaunchShow = <span class="keyword">this</span>.checkBox7.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.DebugConsole = <span class="keyword">this</span>.checkBox8.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.DbgConsole = <span class="keyword">this</span>.checkBox9.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.KillXPlugin = <span class="keyword">this</span>.checkBox10.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.AutoNTVOpen = <span class="keyword">this</span>.checkBox11.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.AutoExitClear = <span class="keyword">this</span>.checkBox12.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.EnablePlugin = <span class="keyword">this</span>.checkBox13.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.config.EnableHotKey = <span class="keyword">this</span>.checkBox14.Checked ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.config.QQScreenShot = <span class="keyword">this</span>.textBox1.Text;</span><br><span class="line">    <span class="keyword">this</span>.config.UsrLib = <span class="keyword">this</span>.textBox2.Text;</span><br><span class="line">    <span class="keyword">this</span>.config.WeChatOCR = <span class="keyword">this</span>.textBox3.Text;</span><br><span class="line">    <span class="keyword">this</span>.config.WeChatUtility = <span class="keyword">this</span>.textBox4.Text;</span><br><span class="line">    <span class="keyword">this</span>.config.PythonDir = <span class="keyword">this</span>.textBox5.Text;</span><br><span class="line">    <span class="keyword">this</span>.config.PluginDir = <span class="keyword">this</span>.textBox6.Text;</span><br><span class="line">    <span class="keyword">this</span>.config.HotKey = <span class="keyword">this</span>.textBox7.Text + <span class="string">&quot;+&quot;</span> + <span class="keyword">this</span>.textBox8.Text + <span class="string">&quot;+&quot;</span> + <span class="keyword">this</span>.textBox9.Text;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.DialogResult = DialogResult.OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在打开对话框的地方判断结果是否为 <code>DialogResult.OK</code>，如果是，则把配置信息写回配置文件，如下面代码第 11~14 行所示</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toolStripMenuItem2_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.form2 == <span class="literal">null</span> || <span class="keyword">this</span>.form2.IsDisposed)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.form2 = <span class="keyword">new</span> Form2(<span class="keyword">this</span>.config);</span><br><span class="line">        <span class="keyword">this</span>.form2.FormClosed += (s, _) =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.form2?.Dispose(); <span class="comment">// 显式释放资源</span></span><br><span class="line">            <span class="keyword">this</span>.form2 = <span class="literal">null</span>;     <span class="comment">// 强制置空</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.form2.ShowDialog() == DialogResult.OK)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.handler.Write(<span class="keyword">this</span>.config);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.form2.Activate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们 <em>Form1</em> 和 <em>Form2</em> 共享同一个 <em>config</em> 变量，这可能不是一种好的做法！！！</p>
<h4 id="为对话框的取消按钮添加事件"><a href="#为对话框的取消按钮添加事件" class="headerlink" title="为对话框的取消按钮添加事件"></a>为对话框的取消按钮添加事件</h4><p>选中 <em>Form2</em> 的<em>取消</em>按钮，在 <em>Properties</em> 中修改 <em>Action &gt; Click</em> 为 <em>button7_Click</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/form2-8.png" class="">

<p>在 <code>button7_Click</code> 方法中设置 <code>this.DialogResult</code> 为 <code>DialogResult.Cancel</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">button7_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.DialogResult = DialogResult.Cancel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时<em>取消</em>按钮的功能和窗口的关闭按钮一致。</p>
<h2 id="添加-QQImpl-动态链接库"><a href="#添加-QQImpl-动态链接库" class="headerlink" title="添加 QQImpl 动态链接库"></a>添加 QQImpl 动态链接库</h2><p>从 <a target="_blank" rel="noopener" href="https://github.com/EEEEhex/QQImpl/releases/tag/v3.0.0">MMMojoCall v3.0.0</a> 下载 <a target="_blank" rel="noopener" href="https://github.com/EEEEhex/QQImpl/releases/download/v3.0.0/x64-Release.zip">x64-Release.zip</a>，解压后将 <em>MMMojoCall.dll</em> 复制到 <em>NTLauncher</em> 项目目录。在 <em>Solution Explorer</em> 选中 <em>MMMojoCall.dll</em>，在 <em>Properties</em> 设置 <em>Advanced &gt; Copy to Output Directory</em> 为 <em>Copy always</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/dll-1.png" class="">

<p>从 <a target="_blank" rel="noopener" href="https://github.com/EEEEhex/QQImpl">QQImpl</a> 下载 <a target="_blank" rel="noopener" href="https://github.com/EEEEhex/QQImpl/blob/main/parent-ipc-core-x64.dll">parent-ipc-core-x64.dll</a> 并将其复制到 <em>NTLauncher</em> 项目目录。在 <em>Solution Explorer</em> 选中 <em>parent-ipc-core-x64.dll</em>，在 <em>Properties</em> 设置 <em>Advanced &gt; Copy to Output Directory</em> 为 <em>Copy always</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/dll-2.png" class="">

<h2 id="编译-QQImpl-动态链接库"><a href="#编译-QQImpl-动态链接库" class="headerlink" title="编译 QQImpl 动态链接库"></a>编译 QQImpl 动态链接库</h2><p>这部分内容参考了以下资料</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/build/reference/dumpbin-reference?view=msvc-170">DUMPBIN 参考</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/build/cmake-projects-in-visual-studio?view=msvc-170">Visual Studio 中的 CMake 项目</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/yxstars/article/details/139889358">用Visual Studio调试CMake项目并生成Visual Studio工程</a></li>
</ol>
<p>从 <a target="_blank" rel="noopener" href="https://github.com/EEEEhex/QQImpl">QQImpl</a> Releases 下载的 <em>MMMojoCall.dll</em> 不包含 <em>qq_mojoipc</em>，可以通过如下的方式进行验证。在 Visual Studio 菜单栏选择 <em>View &gt; Terminal</em> 进入命令提示符</p>
<img src="/2025/03/29/qq-screen-shot-launcher/dumpbin-1.png" class="">

<p>进入 <em>NTLauncher</em> 项目所在的目录 <em>D:\projects\dotnet\QQScreenShotLauncher\NTLauncher</em> 执行 <code>dumpbin /EXPORTS .\MMMojoCall.dll</code> 命令，从结果中未能找到 <em>qq_mojoipc</em> 相关的内容。对 <em>QQScreenShotNT-Plus</em> 使用的 <em>MMMojoCall.dll</em> 执行相同的命令，从结果中可以找到 <em>qq_mojoipc</em> 相关的内容，下面是节选的部分内容</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">20   13 00015A70 ?ConnectedToChildProcess@QQIpcParentWrapper@qqipc@qqimpl@@QEAA_NH@Z</span><br><span class="line">27   1A 00015B40 ?GetLastErrStr@QQIpcChildWrapper@qqipc@qqimpl@@QEAAPEBDXZ</span><br><span class="line">28   1B 00015B40 ?GetLastErrStr@QQIpcParentWrapper@qqipc@qqimpl@@QEAAPEBDXZ</span><br><span class="line">31   1E 00015BB0 ?InitEnv@QQIpcChildWrapper@qqipc@qqimpl@@QEAA_NPEBD@Z</span><br><span class="line">32   1F 00015D40 ?InitEnv@QQIpcParentWrapper@qqipc@qqimpl@@QEAA_NPEBD@Z</span><br><span class="line">33   20 00015ED0 ?InitLog@QQIpcChildWrapper@qqipc@qqimpl@@QEAAXHPEAX@Z</span><br><span class="line">34   21 00015F40 ?InitLog@QQIpcParentWrapper@qqipc@qqimpl@@QEAAXHPEAX@Z</span><br></pre></td></tr></table></figure>

<p>因此，我们需要重新编译 QQImpl 项目。</p>
<p>首先，从 <a target="_blank" rel="noopener" href="https://github.com/EEEEhex/QQImpl">QQImpl</a> 克隆项目，比如克隆到 <code>D:\projects\dotnet</code> 目录，当前最新的提交为 <code>3aac297</code>。解压 <em>3rdparty</em> 目录下的 <em>3rdparty.7z</em> 文件</p>
<img src="/2025/03/29/qq-screen-shot-launcher/dll-3.png" class="">

<p>解压 <em>xplugin_protobuf</em> 目录下的 <em>google.zip</em> 文件</p>
<img src="/2025/03/29/qq-screen-shot-launcher/dll-4.png" class="">

<p>从 <a target="_blank" rel="noopener" href="https://cmake.org/">CMake</a> 网站下载 <a target="_blank" rel="noopener" href="https://github.com/Kitware/CMake/releases/download/v3.31.6/cmake-3.31.6-windows-x86_64.msi">cmake-3.31.6-windows-x86_64.msi</a> 进行安装，在终端输入 <code>cmake -version</code> 验证安装是否成功。在终端进入 <em>D:\projects\dotnet\QQImpl\MMMojoCall</em> 目录，输入如下命令生成解决方案</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -B build -G &quot;Visual Studio 17 2022&quot; -A x64 -DXPLUGIN_WRAPPER=ON -DBUILD_QQIPC=ON -DBUILD_CPPEXAMPLE=ON -DEXAMPLE_USE_JSON=ON -DBUILD_PURE_C_MODE=ON</span><br></pre></td></tr></table></figure>

<p>等待命令执行完成后，使用 Visual Studio 打开 <em>build</em> 目录，即 <em>D:\projects\dotnet\QQImpl\MMMojoCall\build</em>，中的解决方案</p>
<img src="/2025/03/29/qq-screen-shot-launcher/dll-5.png" class="">

<p>在弹出的 <em>Open Project&#x2F;Solution</em> 对话中选择刚生成的解决方案</p>
<img src="/2025/03/29/qq-screen-shot-launcher/dll-6.png" class="">

<p>打开解决方案后在工具栏选择 <em>Release</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/dll-7.png" class="">

<p>随后在菜单栏选择 <em>Build &gt; Build Solution</em> 菜单</p>
<img src="/2025/03/29/qq-screen-shot-launcher/dll-8.png" class="">

<p>编译完成后进入 <em>D:\projects\dotnet\QQImpl\MMMojoCall\build\Release</em> 目录，用编译好的 <em>MMMojoCall.dll</em> 替换 <em>QQScreenShotLauncher</em> 中的同名文件</p>
<img src="/2025/03/29/qq-screen-shot-launcher/dll-9.png" class="">

<p>我们也可以使用 <code>dumpbin /EXPORTS .\MMMojoCall.dll</code> 命令检查是否有 <em>qq_mojoipc</em> 相关的内容</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">Microsoft (R) COFF/PE Dumper Version 14.41.34120.0</span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dump of file .\MMMojoCall.dll</span><br><span class="line"></span><br><span class="line">File Type: DLL</span><br><span class="line"></span><br><span class="line">  Section contains the following exports for MMMojoCall.dll</span><br><span class="line"></span><br><span class="line">    00000000 characteristics</span><br><span class="line">    FFFFFFFF time date stamp</span><br><span class="line">        0.00 version</span><br><span class="line">           1 ordinal base</span><br><span class="line">         105 number of functions</span><br><span class="line">         105 number of names</span><br><span class="line"></span><br><span class="line">    ordinal hint RVA      name</span><br><span class="line"></span><br><span class="line">          1    0 00005CE0 ??0OCRManager@mmmojocall@qqimpl@@QEAA@XZ</span><br><span class="line">          2    1 00007580 ??0PlayerManager@mmmojocall@qqimpl@@QEAA@XZ</span><br><span class="line">          3    2 0001AC10 ??0QQIpcChildWrapper@qqipc@qqimpl@@QEAA@AEBV012@@Z</span><br><span class="line">          4    3 0001AC40 ??0QQIpcChildWrapper@qqipc@qqimpl@@QEAA@XZ</span><br><span class="line">          5    4 0001AC10 ??0QQIpcParentWrapper@qqipc@qqimpl@@QEAA@AEBV012@@Z</span><br><span class="line">          6    5 0001AC40 ??0QQIpcParentWrapper@qqipc@qqimpl@@QEAA@XZ</span><br><span class="line">          7    6 0000A1B0 ??0UtilityManager@mmmojocall@qqimpl@@QEAA@XZ</span><br><span class="line">          8    7 00003240 ??0XPluginManager@mmmojocall@qqimpl@@QEAA@AEBV012@@Z</span><br><span class="line">          9    8 00003420 ??0XPluginManager@mmmojocall@qqimpl@@QEAA@XZ</span><br><span class="line">         10    9 00005F60 ??1OCRManager@mmmojocall@qqimpl@@QEAA@XZ</span><br><span class="line">         11    A 000077E0 ??1PlayerManager@mmmojocall@qqimpl@@QEAA@XZ</span><br><span class="line">         12    B 0001ADD0 ??1QQIpcChildWrapper@qqipc@qqimpl@@QEAA@XZ</span><br><span class="line">         13    C 0001ADD0 ??1QQIpcParentWrapper@qqipc@qqimpl@@QEAA@XZ</span><br><span class="line">         14    D 0000A2C0 ??1UtilityManager@mmmojocall@qqimpl@@QEAA@XZ</span><br><span class="line">         15    E 00003720 ??1XPluginManager@mmmojocall@qqimpl@@QEAA@XZ</span><br><span class="line">         16    F 0001AE50 ??4QQIpcChildWrapper@qqipc@qqimpl@@QEAAAEAV012@AEBV012@@Z</span><br><span class="line">         17   10 0001AE50 ??4QQIpcParentWrapper@qqipc@qqimpl@@QEAAAEAV012@AEBV012@@Z</span><br><span class="line">         18   11 00003880 ??4XPluginManager@mmmojocall@qqimpl@@QEAAAEAV012@AEBV012@@Z</span><br><span class="line">         19   12 00003AD0 ?AppendSwitchNativeCmdLine@XPluginManager@mmmojocall@qqimpl@@QEAA_NPEBD0@Z</span><br><span class="line">         20   13 00006190 ?CallUsrCallback@OCRManager@mmmojocall@qqimpl@@QEAAXHPEBXH@Z</span><br><span class="line">         21   14 0000A360 ?CallUsrCallback@UtilityManager@mmmojocall@qqimpl@@QEAAXHPEBXHV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z</span><br><span class="line">         22   15 0001AEA0 ?ConnectedToChildProcess@QQIpcParentWrapper@qqipc@qqimpl@@QEAA_NH@Z</span><br><span class="line">         23   16 00007AB0 ?CreateCoreStatusSync@PlayerManager@mmmojocall@qqimpl@@AEAAXH@Z</span><br><span class="line">         24   17 00007B70 ?CreatePlayerCore@PlayerManager@mmmojocall@qqimpl@@QEAAHXZ</span><br><span class="line">         25   18 00007E20 ?DeleteCoreStatusSync@PlayerManager@mmmojocall@qqimpl@@AEAAXH@Z</span><br><span class="line">         26   19 00007FC0 ?DestroyPlayerCore@PlayerManager@mmmojocall@qqimpl@@QEAAXH@Z</span><br><span class="line">         27   1A 000064A0 ?DoOCRTask@OCRManager@mmmojocall@qqimpl@@QEAA_NPEBD@Z</span><br><span class="line">         28   1B 0000A6E0 ?DoPicQRScan@UtilityManager@mmmojocall@qqimpl@@QEAA_NPEBDH@Z</span><br><span class="line">         29   1C 0000AAD0 ?DoResampleImage@UtilityManager@mmmojocall@qqimpl@@QEAA_NV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@0HH@Z</span><br><span class="line">         30   1D 00006820 ?GetConnectState@OCRManager@mmmojocall@qqimpl@@QEAA_NXZ</span><br><span class="line">         31   1E 00008130 ?GetConnectState@PlayerManager@mmmojocall@qqimpl@@QEAA_NXZ</span><br><span class="line">         32   1F 0000ADF0 ?GetConnectState@UtilityManager@mmmojocall@qqimpl@@QEAA_NXZ</span><br><span class="line">         33   20 00008140 ?GetCurrentPosition@PlayerManager@mmmojocall@qqimpl@@QEAAHH@Z</span><br><span class="line">         34   21 000081D0 ?GetIdlePlayerCoreId@PlayerManager@mmmojocall@qqimpl@@AEAAHXZ</span><br><span class="line">         35   22 00006830 ?GetIdleTaskId@OCRManager@mmmojocall@qqimpl@@AEAAHXZ</span><br><span class="line">         36   23 0001AF70 ?GetLastErrStr@QQIpcChildWrapper@qqipc@qqimpl@@QEAAPEBDXZ</span><br><span class="line">         37   24 0001AF70 ?GetLastErrStr@QQIpcParentWrapper@qqipc@qqimpl@@QEAAPEBDXZ</span><br><span class="line">         38   25 00003CD0 ?GetLastErrStr@XPluginManager@mmmojocall@qqimpl@@QEAAPEBDXZ</span><br><span class="line">         39   26 00008280 ?GetPlayerCoreNum@PlayerManager@mmmojocall@qqimpl@@QEAAHXZ</span><br><span class="line">         40   27 00008290 ?GetPlayerCoreStatus@PlayerManager@mmmojocall@qqimpl@@QEAAPEAUCoreStatus@123@H@Z</span><br><span class="line">         41   28 0001AF80 ?InitChildIpc@QQIpcChildWrapper@qqipc@qqimpl@@QEAAXXZ</span><br><span class="line">         42   29 0001AFE0 ?InitEnv@QQIpcChildWrapper@qqipc@qqimpl@@QEAA_NPEBD@Z</span><br><span class="line">         43   2A 0001B180 ?InitEnv@QQIpcParentWrapper@qqipc@qqimpl@@QEAA_NPEBD@Z</span><br><span class="line">         44   2B 0001B320 ?InitLog@QQIpcChildWrapper@qqipc@qqimpl@@QEAAXHPEAX@Z</span><br><span class="line">         45   2C 0001B390 ?InitLog@QQIpcParentWrapper@qqipc@qqimpl@@QEAAXHPEAX@Z</span><br><span class="line">         46   2D 0001B410 ?InitParentIpc@QQIpcParentWrapper@qqipc@qqimpl@@QEAAXXZ</span><br><span class="line">         47   2E 000082F0 ?InitPlayerCore@PlayerManager@mmmojocall@qqimpl@@QEAAHHPEAUHWND__@@PEBD1_J_N3M3M@Z</span><br><span class="line">         48   2F 000068E0 ?KillWeChatOCR@OCRManager@mmmojocall@qqimpl@@QEAAXXZ</span><br><span class="line">         49   30 00008640 ?KillWeChatPlayer@PlayerManager@mmmojocall@qqimpl@@QEAAXXZ</span><br><span class="line">         50   31 0000AE00 ?KillWeChatUtility@UtilityManager@mmmojocall@qqimpl@@QEAAXXZ</span><br><span class="line">         51   32 0001B470 ?LaunchChildProcess@QQIpcParentWrapper@qqipc@qqimpl@@QEAAHPEBDP6AXPEAXPEADH2H@Z1PEAPEADH@Z</span><br><span class="line">         52   33 00008650 ?MuteVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NH_N@Z</span><br><span class="line">         53   34 0001B620 ?OnDefaultReceiveMsg@QQIpcParentWrapper@qqipc@qqimpl@@SAXPEAXPEADH1H@Z</span><br><span class="line">         54   35 000087C0 ?PauseVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NH@Z</span><br><span class="line">         55   36 0001B730 ?ReLaunchChildProcess@QQIpcParentWrapper@qqipc@qqimpl@@QEAAHH@Z</span><br><span class="line">         56   37 00008E80 ?RepeatVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NH_N@Z</span><br><span class="line">         57   38 00008FF0 ?ResumeVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NH@Z</span><br><span class="line">         58   39 00009140 ?ResziePlayerCore@PlayerManager@mmmojocall@qqimpl@@QEAA_NHHH@Z</span><br><span class="line">         59   3A 000092C0 ?RunEvent@PlayerManager@mmmojocall@qqimpl@@QEAAXHH@Z</span><br><span class="line">         60   3B 00009330 ?SeekToVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NHH@Z</span><br><span class="line">         61   3C 0001B7E0 ?SendIpcMessage@QQIpcChildWrapper@qqipc@qqimpl@@QEAAXPEBD0H@Z</span><br><span class="line">         62   3D 0001B860 ?SendIpcMessage@QQIpcParentWrapper@qqipc@qqimpl@@QEAA_NHPEBD0H@Z</span><br><span class="line">         63   3E 00006A10 ?SendOCRTask@OCRManager@mmmojocall@qqimpl@@AEAA_NIV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z</span><br><span class="line">         64   3F 00003CE0 ?SendPbSerializedData@XPluginManager@mmmojocall@qqimpl@@QEAAXPEAXHH_NI@Z</span><br><span class="line">         65   40 00006C90 ?SetCallbackDataMode@OCRManager@mmmojocall@qqimpl@@QEAAX_N@Z</span><br><span class="line">         66   41 0000AE10 ?SetCallbackDataMode@UtilityManager@mmmojocall@qqimpl@@QEAAX_N@Z</span><br><span class="line">         67   42 00003D60 ?SetCallbackUsrData@XPluginManager@mmmojocall@qqimpl@@QEAAXPEAX@Z</span><br><span class="line">         68   43 00003D70 ?SetCallbacks@XPluginManager@mmmojocall@qqimpl@@QEAAXUMMMojoEnvironmentCallbacks@common@mmmojo@@@Z</span><br><span class="line">         69   44 0001B950 ?SetChildReceiveCallback@QQIpcChildWrapper@qqipc@qqimpl@@QEAAXP6AXPEAXPEADH1H@Z@Z</span><br><span class="line">         70   45 00006CA0 ?SetConnectState@OCRManager@mmmojocall@qqimpl@@QEAAX_N@Z</span><br><span class="line">         71   46 00009580 ?SetConnectState@PlayerManager@mmmojocall@qqimpl@@QEAAX_N@Z</span><br><span class="line">         72   47 0000AE20 ?SetConnectState@UtilityManager@mmmojocall@qqimpl@@QEAAX_N@Z</span><br><span class="line">         73   48 00003DA0 ?SetExePath@XPluginManager@mmmojocall@qqimpl@@QEAA_NPEBD@Z</span><br><span class="line">         74   49 00003FE0 ?SetLastErrStr@XPluginManager@mmmojocall@qqimpl@@IEAAXV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z</span><br><span class="line">         75   4A 0001B9D0 ?SetLogLevel@QQIpcParentWrapper@qqipc@qqimpl@@QEAAXH@Z</span><br><span class="line">         76   4B 00004080 ?SetOneCallback@XPluginManager@mmmojocall@qqimpl@@QEAAXHPEAX@Z</span><br><span class="line">         77   4C 00009590 ?SetPlayerCoreIdIdle@PlayerManager@mmmojocall@qqimpl@@AEAA_NH@Z</span><br><span class="line">         78   4D 0000AEA0 ?SetReadOnPull@UtilityManager@mmmojocall@qqimpl@@QEAAXP6AXHPEBXH@Z@Z</span><br><span class="line">         79   4E 00006D20 ?SetReadOnPush@OCRManager@mmmojocall@qqimpl@@QEAAXP6AXPEBDPEBXH@Z@Z</span><br><span class="line">         80   4F 0000AEB0 ?SetReadOnPush@UtilityManager@mmmojocall@qqimpl@@QEAAXP6AXHPEBXH@Z@Z</span><br><span class="line">         81   50 000095B0 ?SetSpeedVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NHM@Z</span><br><span class="line">         82   51 00009730 ?SetSurfaceVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NHPEAUHWND__@@@Z</span><br><span class="line">         83   52 000098B0 ?SetSwitchArgs@PlayerManager@mmmojocall@qqimpl@@QEAA_NPEBD00@Z</span><br><span class="line">         84   53 00006D30 ?SetTaskIdIdle@OCRManager@mmmojocall@qqimpl@@AEAA_NH@Z</span><br><span class="line">         85   54 00006D50 ?SetUsrLibDir@OCRManager@mmmojocall@qqimpl@@QEAA_NPEBD@Z</span><br><span class="line">         86   55 0000AEC0 ?SetUsrLibDir@UtilityManager@mmmojocall@qqimpl@@QEAA_NPEBD@Z</span><br><span class="line">         87   56 00009920 ?SetVolumeVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NHM@Z</span><br><span class="line">         88   57 00004100 ?StartMMMojoEnv@XPluginManager@mmmojocall@qqimpl@@QEAA_NXZ</span><br><span class="line">         89   58 00009AA0 ?StartVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NH@Z</span><br><span class="line">         90   59 00006DB0 ?StartWeChatOCR@OCRManager@mmmojocall@qqimpl@@QEAA_NXZ</span><br><span class="line">         91   5A 00009C00 ?StartWeChatPlayer@PlayerManager@mmmojocall@qqimpl@@QEAA_NXZ</span><br><span class="line">         92   5B 0000AF20 ?StartWeChatUtility@UtilityManager@mmmojocall@qqimpl@@QEAA_NXZ</span><br><span class="line">         93   5C 00004830 ?StopMMMojoEnv@XPluginManager@mmmojocall@qqimpl@@QEAAXXZ</span><br><span class="line">         94   5D 00009C30 ?StopVideo@PlayerManager@mmmojocall@qqimpl@@QEAA_NH@Z</span><br><span class="line">         95   5E 0001BA40 ?TerminateChildProcess@QQIpcParentWrapper@qqipc@qqimpl@@QEAA_NHH_N@Z</span><br><span class="line">         96   5F 00009D90 ?WaitEvent@PlayerManager@mmmojocall@qqimpl@@QEAAXHH@Z</span><br><span class="line">         97   60 000054C0 CallFuncXPluginMgr</span><br><span class="line">         98   61 00005B70 GetInstanceXPluginMgr</span><br><span class="line">         99   62 00004C70 GetPbSerializedData</span><br><span class="line">        100   63 00004CB0 GetReadInfoAttachData</span><br><span class="line">        101   64 00004CF0 InitMMMojoDLLFuncs</span><br><span class="line">        102   65 00005450 InitMMMojoGlobal</span><br><span class="line">        103   66 00005C10 ReleaseInstanceXPluginMgr</span><br><span class="line">        104   67 00005480 RemoveReadInfo</span><br><span class="line">        105   68 00005490 ShutdownMMMojoGlobal</span><br><span class="line"></span><br><span class="line">  Summary</span><br><span class="line"></span><br><span class="line">        8000 .data</span><br><span class="line">        C000 .pdata</span><br><span class="line">       38000 .rdata</span><br><span class="line">        3000 .reloc</span><br><span class="line">        1000 .rsrc</span><br><span class="line">       FB000 .text</span><br></pre></td></tr></table></figure>

<h2 id="包装-QQImpl-动态链接库"><a href="#包装-QQImpl-动态链接库" class="headerlink" title="包装 QQImpl 动态链接库"></a>包装 QQImpl 动态链接库</h2><h3 id="创建动态链接库"><a href="#创建动态链接库" class="headerlink" title="创建动态链接库"></a>创建动态链接库</h3><p>在 <em>Solution Explorer</em> 选中 <em>QQScreenShotLauncher</em> 解决方案，在右键菜单中选择 <em>Add &gt; New Project</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/create-project-1.png" class="">

<p>在 <em>Add a new project</em> 对话框选择 <em>C++</em>、<em>Windows</em>、<em>Library</em>、<em>Dynamic-Link Library (DLL)</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/wrapper-1.png" class="">

<p>在 <em>Configure your new project</em> 对话框填写 <em>Project name</em> 为 <em>MMMojoCallWrapper</em>，<em>Location</em> 保持默认</p>
<img src="/2025/03/29/qq-screen-shot-launcher/wrapper-2.png" class="">

<h3 id="添加-h-和-lib-文件"><a href="#添加-h-和-lib-文件" class="headerlink" title="添加 .h 和 .lib 文件"></a>添加 .h 和 .lib 文件</h3><p>在 <em>QQImpl</em> 项目找到 <em>qq_ipc.h</em> 文件，把它复制到 <em>D:\projects\dotnet\QQScreenShotLauncher\MMMojoCallWrapper</em> 目录</p>
<img src="/2025/03/29/qq-screen-shot-launcher/wrapper-3.png" class="">

<p>在 <em>QQImpl</em> 项目找到 <em>MMMojoCall.lib</em> 文件，把它复制到 <em>D:\projects\dotnet\QQScreenShotLauncher\MMMojoCallWrapper</em> 目录</p>
<img src="/2025/03/29/qq-screen-shot-launcher/wrapper-4.png" class="">

<p>在 <em>Solution Explorer</em> 选中 <em>MMMojoCallWrapper</em> 项目的 <em>Header Files</em>，在右键菜单选择 <em>Add &gt; Existing Item</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/wrapper-5.png" class="">

<p>在 <em>Add Existing Item</em> 对话框选择刚刚添加的 <em>qq_ipc.h</em> 文件</p>
<img src="/2025/03/29/qq-screen-shot-launcher/wrapper-6.png" class="">

<p>对 <em>qq_ipc.h</em> 头文件依赖的 <em>mojo_call_export.h</em> 头文件进行相同的操作。</p>
<h3 id="添加动态链接库包装"><a href="#添加动态链接库包装" class="headerlink" title="添加动态链接库包装"></a>添加动态链接库包装</h3><p>在 <em>Solution Explorer</em> 选中 <em>MMMojoCallWrapper</em> 项目，在右键菜单中选择 <em>Add &gt; Class</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/wrapper-7.png" class="">

<p>在 <em>Add Class</em> 对话框输入类名 <em>MMMojoCallWrapper</em>，其他保持默认</p>
<img src="/2025/03/29/qq-screen-shot-launcher/wrapper-8.png" class="">

<p>下面的内容参考以下资料</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/houbincarson/article/details/143191834">C#与C++交互开发系列（十一）：委托和函数指针传递</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/framework/interop/marshalling-a-delegate-as-a-callback-method">将委托作为回调方法进行封送</a></li>
</ol>
<p><em>MMMojoCallWrapper.h</em> 文件的内容如下所示</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> MMMOJOCALLWRAPPER_EXPORTS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MMMOJOCALLWRAPPER_API __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MMMOJOCALLWRAPPER_API __declspec(dllimport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>  <span class="function">MMMOJOCALLWRAPPER_API <span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*CallbackIpc)</span><span class="params">(<span class="type">void</span>*, <span class="type">char</span>*, <span class="type">int</span>, <span class="type">char</span>*, <span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// QQIpcParentWrapper</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span>* <span class="title">CreateQQIpcParentWrapper</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">DeleteQQIpcParentWrapper</span><span class="params">(<span class="type">void</span>* instance)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcParentWrapper_OnDefaultReceiveMsg</span><span class="params">(<span class="type">void</span>* pArg, <span class="type">char</span>* msg, <span class="type">int</span> arg3, <span class="type">char</span>* addition_msg, <span class="type">int</span> addition_msg_size)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_InitEnv</span><span class="params">(<span class="type">void</span>* instance, <span class="type">const</span> <span class="type">char</span>* dll_path)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcParentWrapper_SetLogLevel</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> level)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">const</span> <span class="type">char</span>* <span class="title">QQIpcParentWrapper_GetLastErrStr</span><span class="params">(<span class="type">void</span>* instance)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcParentWrapper_InitLog</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> level, <span class="type">void</span>* callback)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcParentWrapper_InitParentIpc</span><span class="params">(<span class="type">void</span>* instance)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">int</span> <span class="title">QQIpcParentWrapper_LaunchChildProcess</span><span class="params">(<span class="type">void</span>* instance, <span class="type">const</span> <span class="type">char</span>* file_path, CallbackIpc callback, <span class="type">void</span>* cb_arg, <span class="type">char</span>** cmdlines, <span class="type">int</span> cmd_num)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_ConnectedToChildProcess</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> pid)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_SendIpcMessage</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> pid, <span class="type">const</span> <span class="type">char</span>* command, <span class="type">const</span> <span class="type">char</span>* addition_msg, <span class="type">int</span> addition_msg_size)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_TerminateChildProcess</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> pid, <span class="type">int</span> exit_code, <span class="type">bool</span> wait_)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_ReLaunchChildProcess</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> pid)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// QQIpcChildWrapper</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span>* <span class="title">CreateQQIpcChildWrapper</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">DeleteQQIpcChildWrapper</span><span class="params">(<span class="type">void</span>* instance)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">const</span> <span class="type">char</span>* <span class="title">QQIpcChildWrapper_GetLastErrStr</span><span class="params">(<span class="type">void</span>* instance)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcChildWrapper_InitEnv</span><span class="params">(<span class="type">void</span>* instance, <span class="type">const</span> <span class="type">char</span>* dll_path)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcChildWrapper_InitChildIpc</span><span class="params">(<span class="type">void</span>* instance)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcChildWrapper_InitLog</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> level, <span class="type">void</span>* callback)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcChildWrapper_SetChildReceiveCallback</span><span class="params">(<span class="type">void</span>* instance, CallbackIpc callback)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcChildWrapper_SendIpcMessage</span><span class="params">(<span class="type">void</span>* instance, <span class="type">const</span> <span class="type">char</span>* command, <span class="type">const</span> <span class="type">char</span>* addition_msg, <span class="type">int</span> addition_msg_size)</span></span>;</span><br></pre></td></tr></table></figure>

<p><em>MMMojoCallWrapper.cpp</em> 文件的内容如下所示</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MMMojoCallWrapper.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qq_ipc.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;MMMojoCall.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// QQIpcParentWrapper</span></span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span>* <span class="title">CreateQQIpcParentWrapper</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> qqimpl::qqipc::<span class="built_in">QQIpcParentWrapper</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">DeleteQQIpcParentWrapper</span><span class="params">(<span class="type">void</span>* instance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">delete</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcParentWrapper_OnDefaultReceiveMsg</span><span class="params">(<span class="type">void</span>* pArg, <span class="type">char</span>* msg, <span class="type">int</span> arg3, <span class="type">char</span>* addition_msg, <span class="type">int</span> addition_msg_size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> qqimpl::qqipc::QQIpcParentWrapper::<span class="built_in">OnDefaultReceiveMsg</span>(pArg, msg, arg3, addition_msg, addition_msg_size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_InitEnv</span><span class="params">(<span class="type">void</span>* instance, <span class="type">const</span> <span class="type">char</span>* dll_path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">InitEnv</span>(dll_path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcParentWrapper_SetLogLevel</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> level)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">SetLogLevel</span>(level);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">const</span> <span class="type">char</span>* <span class="title">QQIpcParentWrapper_GetLastErrStr</span><span class="params">(<span class="type">void</span>* instance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">GetLastErrStr</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcParentWrapper_InitLog</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> level, <span class="type">void</span>* callback)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">InitLog</span>(level, callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcParentWrapper_InitParentIpc</span><span class="params">(<span class="type">void</span>* instance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">InitParentIpc</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">int</span> <span class="title">QQIpcParentWrapper_LaunchChildProcess</span><span class="params">(<span class="type">void</span>* instance, <span class="type">const</span> <span class="type">char</span>* file_path, CallbackIpc callback, <span class="type">void</span>* cb_arg, <span class="type">char</span>** cmdlines, <span class="type">int</span> cmd_num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">LaunchChildProcess</span>(file_path, callback, cb_arg, cmdlines, cmd_num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_ConnectedToChildProcess</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> pid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">ConnectedToChildProcess</span>(pid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_SendIpcMessage</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> pid, <span class="type">const</span> <span class="type">char</span>* command, <span class="type">const</span> <span class="type">char</span>* addition_msg, <span class="type">int</span> addition_msg_size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">SendIpcMessage</span>(pid, command, addition_msg, addition_msg_size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_TerminateChildProcess</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> pid, <span class="type">int</span> exit_code, <span class="type">bool</span> wait_)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">TerminateChildProcess</span>(pid, exit_code, wait_);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcParentWrapper_ReLaunchChildProcess</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> pid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcParentWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcParentWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">ReLaunchChildProcess</span>(pid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// QQIpcChildWrapper</span></span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span>* <span class="title">CreateQQIpcChildWrapper</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> qqimpl::qqipc::<span class="built_in">QQIpcChildWrapper</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">DeleteQQIpcChildWrapper</span><span class="params">(<span class="type">void</span>* instance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcChildWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcChildWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">delete</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">const</span> <span class="type">char</span>* <span class="title">QQIpcChildWrapper_GetLastErrStr</span><span class="params">(<span class="type">void</span>* instance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcChildWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcChildWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">GetLastErrStr</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">bool</span> <span class="title">QQIpcChildWrapper_InitEnv</span><span class="params">(<span class="type">void</span>* instance, <span class="type">const</span> <span class="type">char</span>* dll_path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcChildWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcChildWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">InitEnv</span>(dll_path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcChildWrapper_InitChildIpc</span><span class="params">(<span class="type">void</span>* instance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcChildWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcChildWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">InitChildIpc</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcChildWrapper_InitLog</span><span class="params">(<span class="type">void</span>* instance, <span class="type">int</span> level, <span class="type">void</span>* callback)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcChildWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcChildWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">InitLog</span>(level, callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcChildWrapper_SetChildReceiveCallback</span><span class="params">(<span class="type">void</span>* instance, CallbackIpc callback)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcChildWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcChildWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">SetChildReceiveCallback</span>(callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MMMOJOCALLWRAPPER_API <span class="type">void</span> <span class="title">QQIpcChildWrapper_SendIpcMessage</span><span class="params">(<span class="type">void</span>* instance, <span class="type">const</span> <span class="type">char</span>* command, <span class="type">const</span> <span class="type">char</span>* addition_msg, <span class="type">int</span> addition_msg_size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qqimpl::qqipc::QQIpcChildWrapper* o = <span class="built_in">static_cast</span>&lt;qqimpl::qqipc::QQIpcChildWrapper*&gt;(instance);</span><br><span class="line">	<span class="keyword">return</span> o-&gt;<span class="built_in">SendIpcMessage</span>(command, addition_msg, addition_msg_size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译 <em>MMMojoCallWrapper</em> 项目，在终端进入 <em>D:\projects\dotnet\QQScreenShotLauncher\x64\Debug</em> 目录执行 <code>dumpbin /exports .\MMMojoCallWrapper.dll</code> 命令</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">Microsoft (R) COFF/PE Dumper Version 14.41.34120.0</span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dump of file .\MMMojoCallWrapper.dll</span><br><span class="line"></span><br><span class="line">File Type: DLL</span><br><span class="line"></span><br><span class="line">  Section contains the following exports for MMMojoCallWrapper.dll</span><br><span class="line"></span><br><span class="line">    00000000 characteristics</span><br><span class="line">    FFFFFFFF time date stamp</span><br><span class="line">        0.00 version</span><br><span class="line">           1 ordinal base</span><br><span class="line">          21 number of functions</span><br><span class="line">          21 number of names</span><br><span class="line"></span><br><span class="line">    ordinal hint RVA      name</span><br><span class="line"></span><br><span class="line">          1    0 00011424 CreateQQIpcChildWrapper = @ILT+1055(CreateQQIpcChildWrapper)</span><br><span class="line">          2    1 000110E1 CreateQQIpcParentWrapper = @ILT+220(CreateQQIpcParentWrapper)</span><br><span class="line">          3    2 000112F8 DeleteQQIpcChildWrapper = @ILT+755(DeleteQQIpcChildWrapper)</span><br><span class="line">          4    3 00011375 DeleteQQIpcParentWrapper = @ILT+880(DeleteQQIpcParentWrapper)</span><br><span class="line">          5    4 000112DA QQIpcChildWrapper_GetLastErrStr = @ILT+725(QQIpcChildWrapper_GetLastErrStr)</span><br><span class="line">          6    5 00011460 QQIpcChildWrapper_InitChildIpc = @ILT+1115(QQIpcChildWrapper_InitChildIpc)</span><br><span class="line">          7    6 00011244 QQIpcChildWrapper_InitEnv = @ILT+575(QQIpcChildWrapper_InitEnv)</span><br><span class="line">          8    7 000111A4 QQIpcChildWrapper_InitLog = @ILT+415(QQIpcChildWrapper_InitLog)</span><br><span class="line">          9    8 0001146F QQIpcChildWrapper_SendIpcMessage = @ILT+1130(QQIpcChildWrapper_SendIpcMessage)</span><br><span class="line">         10    9 00011014 QQIpcChildWrapper_SetChildReceiveCallback = @ILT+15(QQIpcChildWrapper_SetChildReceiveCallback)</span><br><span class="line">         11    A 000112D5 QQIpcParentWrapper_ConnectedToChildProcess = @ILT+720(QQIpcParentWrapper_ConnectedToChildProcess)</span><br><span class="line">         12    B 000112C6 QQIpcParentWrapper_GetLastErrStr = @ILT+705(QQIpcParentWrapper_GetLastErrStr)</span><br><span class="line">         13    C 000113BB QQIpcParentWrapper_InitEnv = @ILT+950(QQIpcParentWrapper_InitEnv)</span><br><span class="line">         14    D 0001112C QQIpcParentWrapper_InitLog = @ILT+295(QQIpcParentWrapper_InitLog)</span><br><span class="line">         15    E 000112B2 QQIpcParentWrapper_InitParentIpc = @ILT+685(QQIpcParentWrapper_InitParentIpc)</span><br><span class="line">         16    F 00011113 QQIpcParentWrapper_LaunchChildProcess = @ILT+270(QQIpcParentWrapper_LaunchChildProcess)</span><br><span class="line">         17   10 0001143D QQIpcParentWrapper_OnDefaultReceiveMsg = @ILT+1080(QQIpcParentWrapper_OnDefaultReceiveMsg)</span><br><span class="line">         18   11 00011302 QQIpcParentWrapper_ReLaunchChildProcess = @ILT+765(QQIpcParentWrapper_ReLaunchChildProcess)</span><br><span class="line">         19   12 000113D4 QQIpcParentWrapper_SendIpcMessage = @ILT+975(QQIpcParentWrapper_SendIpcMessage)</span><br><span class="line">         20   13 000110BE QQIpcParentWrapper_SetLogLevel = @ILT+185(QQIpcParentWrapper_SetLogLevel)</span><br><span class="line">         21   14 000110F0 QQIpcParentWrapper_TerminateChildProcess = @ILT+235(QQIpcParentWrapper_TerminateChildProcess)</span><br><span class="line"></span><br><span class="line">  Summary</span><br><span class="line"></span><br><span class="line">        1000 .00cfg</span><br><span class="line">        1000 .data</span><br><span class="line">        2000 .idata</span><br><span class="line">        1000 .msvcjmc</span><br><span class="line">        3000 .pdata</span><br><span class="line">        4000 .rdata</span><br><span class="line">        1000 .reloc</span><br><span class="line">        1000 .rsrc</span><br><span class="line">        A000 .text</span><br><span class="line">       10000 .textbss</span><br></pre></td></tr></table></figure>

<h2 id="实现-QQ-截图功能"><a href="#实现-QQ-截图功能" class="headerlink" title="实现 QQ 截图功能"></a>实现 QQ 截图功能</h2><p>这部分内容参考以下资料</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/dotnet/framework/interop/consuming-unmanaged-dll-functions">使用非托管 DLL 函数</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38409301/article/details/121869272">用vs完整的搭建一个项目流程(包括多个项目之间的依赖) 方法一</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhizhengguan/article/details/112764805">Visual Studio 2019：引用动态DLL项目</a></li>
</ol>
<h3 id="添加项目依赖"><a href="#添加项目依赖" class="headerlink" title="添加项目依赖"></a>添加项目依赖</h3><p>在 <em>Solution Explorer</em> 选中 <em>NTLauncher</em> 项目，在右键菜单中选择 <em>Build Dependencies &gt; Project Dependencies</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/shot-1.png" class="">

<p>在弹出的 <em>Project Dependencies</em> 对话框中选中 <em>MMMojoCallWrapper</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/shot-2.png" class="">

<p>选中 <em>NTLauncher</em> 项目，在右键菜单中选择 <em>Properties</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/add-icon-1.png" class="">

<p>选中 <em>Build &gt; Events</em>，在 <em>Post-build event</em> 输入 <code>xcopy /y /d &quot;$(SolutionDir)x64\$(Configuration)\$(IntDir)MMMojoCallWrapper.dll&quot; &quot;$(OutDir)&quot;</code></p>
<img src="/2025/03/29/qq-screen-shot-launcher/shot-3.png" class="">

<h3 id="实现动态链接库包装"><a href="#实现动态链接库包装" class="headerlink" title="实现动态链接库包装"></a>实现动态链接库包装</h3><p>在 <em>Solution Explorer</em> 选中 <em>NTLauncher</em> 项目，在右键菜单中选择 <em>Add Class</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/shot-4.png" class="">

<p>在弹出的 <em>Add New Item</em> 对话框中创建一个 <em>Class</em>，名称为 <em>QQIpcWrapper.cs</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/shot-5.png" class="">

<p><em>QQIpcWrapper.cs</em> 的实现如下所示，注意以下事项：</p>
<ul>
<li><code>void*</code> 在 C# 中通常是 <code>IntPtr</code>。</li>
<li>请求参数 <code>char*</code> 映射为 <code>string</code>，并默认认定为 UTF-8 字符串。如果需要其他编码，可以进一步处理。</li>
<li>响应参数为 <code>bool</code> 时需要加上 <code>[return: MarshalAs(UnmanagedType.I1)]</code> 标记，表示 C++ 的 <code>bool</code> 只占一个字节。</li>
<li><code>CallbackIpc</code> 使用 <code>[UnmanagedFunctionPointer]</code> 指定调用约定为 <code>CallingConvention.Cdecl</code>。</li>
<li><code>cmdlines</code> 参数为 <code>char**</code>，可以传递一个 <code>string[]</code>，由 C# 处理自动封送到非托管代码中。</li>
<li>对 <code>QQIpcParentWrapper_GetLastErrStr</code> 函数的响应参数采用 <code>IntPtr</code> 是因为该函数返回的是一个指向 C++ 字符串的指针 (<code>const char*</code>)。在 C# 中，我们无法直接对指针类型的数据进行处理，并且不能知道返回的字符串是如何管理内存的（例如：是否是动态分配的、是否需要释放）。因此将返回值指定为 <code>IntPtr</code>，并根据需要在 C# 中手动解析它为字符串。返回的字符串以 ANSI 编码表示时使用 <code>Marshal.PtrToStringAnsi(ptr)</code>，返回的字符串以 UTF-8 编码表示时使用 <code>Marshal.PtrToStringUTF8(ptr)</code>（适用 .NET 5 或更高版本）。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">NTLauncher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">QQIpcWrapper</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Typedef 对应的委托</span></span><br><span class="line">        [<span class="meta">UnmanagedFunctionPointer(CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">CallbackIpc</span>(<span class="params">IntPtr pArg, <span class="built_in">string</span> msg, <span class="built_in">int</span> arg3, <span class="built_in">string</span> addition_msg, <span class="built_in">int</span> addition_msg_size</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// QQIpcParentWrapper</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;CreateQQIpcParentWrapper&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">CreateQQIpcParentWrapper</span>()</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;DeleteQQIpcParentWrapper&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">DeleteQQIpcParentWrapper</span>(<span class="params">IntPtr instance</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_OnDefaultReceiveMsg&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">QQIpcParentWrapper_OnDefaultReceiveMsg</span>(<span class="params">IntPtr pArg, <span class="built_in">string</span> msg, <span class="built_in">int</span> arg3, <span class="built_in">string</span> addition_msg, <span class="built_in">int</span> addition_msg_size</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_InitEnv&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        [<span class="meta">return: MarshalAs(UnmanagedType.I1)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">QQIpcParentWrapper_InitEnv</span>(<span class="params">IntPtr instance, <span class="built_in">string</span> dll_path</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_SetLogLevel&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">QQIpcParentWrapper_SetLogLevel</span>(<span class="params">IntPtr instance, <span class="built_in">int</span> level</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_GetLastErrStr&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">QQIpcParentWrapper_GetLastErrStr</span>(<span class="params">IntPtr instance</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_InitLog&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">QQIpcParentWrapper_InitLog</span>(<span class="params">IntPtr instance, <span class="built_in">int</span> level, IntPtr callback</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_InitParentIpc&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">QQIpcParentWrapper_InitParentIpc</span>(<span class="params">IntPtr instance</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_LaunchChildProcess&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">int</span> <span class="title">QQIpcParentWrapper_LaunchChildProcess</span>(<span class="params">IntPtr instance, <span class="built_in">string</span> file_path, CallbackIpc callback, IntPtr cb_arg, <span class="built_in">string</span>[] cmdlines, <span class="built_in">int</span> cmd_num</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_ConnectedToChildProcess&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        [<span class="meta">return: MarshalAs(UnmanagedType.I1)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">QQIpcParentWrapper_ConnectedToChildProcess</span>(<span class="params">IntPtr instance, <span class="built_in">int</span> pid</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_SendIpcMessage&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        [<span class="meta">return: MarshalAs(UnmanagedType.I1)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">QQIpcParentWrapper_SendIpcMessage</span>(<span class="params">IntPtr instance, <span class="built_in">int</span> pid, <span class="built_in">string</span> command, <span class="built_in">string</span> addition_msg, <span class="built_in">int</span> addition_msg_size</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_TerminateChildProcess&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        [<span class="meta">return: MarshalAs(UnmanagedType.I1)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">QQIpcParentWrapper_TerminateChildProcess</span>(<span class="params">IntPtr instance, <span class="built_in">int</span> pid, <span class="built_in">int</span> exit_code, <span class="built_in">bool</span> wait_</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcParentWrapper_ReLaunchChildProcess&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        [<span class="meta">return: MarshalAs(UnmanagedType.I1)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">QQIpcParentWrapper_ReLaunchChildProcess</span>(<span class="params">IntPtr instance, <span class="built_in">int</span> pid</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// QQIpcChildWrapper</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;CreateQQIpcChildWrapper&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">CreateQQIpcChildWrapper</span>()</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;DeleteQQIpcChildWrapper&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">DeleteQQIpcChildWrapper</span>(<span class="params">IntPtr instance</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcChildWrapper_GetLastErrStr&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">QQIpcChildWrapper_GetLastErrStr</span>(<span class="params">IntPtr instance</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcChildWrapper_InitEnv&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        [<span class="meta">return: MarshalAs(UnmanagedType.I1)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">QQIpcChildWrapper_InitEnv</span>(<span class="params">IntPtr instance, <span class="built_in">string</span> dll_path</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcChildWrapper_InitChildIpc&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">QQIpcChildWrapper_InitChildIpc</span>(<span class="params">IntPtr instance</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcChildWrapper_InitLog&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">QQIpcChildWrapper_InitLog</span>(<span class="params">IntPtr instance, <span class="built_in">int</span> level, IntPtr callback</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcChildWrapper_SetChildReceiveCallback&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">QQIpcChildWrapper_SetChildReceiveCallback</span>(<span class="params">IntPtr instance, CallbackIpc callback</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;MMMojoCallWrapper.dll&quot;</span>, EntryPoint = <span class="string">&quot;QQIpcChildWrapper_SendIpcMessage&quot;</span>, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">QQIpcChildWrapper_SendIpcMessage</span>(<span class="params">IntPtr instance, <span class="built_in">string</span> command, <span class="built_in">string</span> addition_msg, <span class="built_in">int</span> addition_msg_size</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定义-IPC-回调"><a href="#定义-IPC-回调" class="headerlink" title="定义 IPC 回调"></a>定义 IPC 回调</h3><p>在 <em>Form1.cs</em> 中定义 IPC 回调</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> QQIpcWrapper.CallbackIpc callbackIpc = (IntPtr pArg, <span class="built_in">string</span> msg, <span class="built_in">int</span> arg3, <span class="built_in">string</span> addition_msg, <span class="built_in">int</span> addition_msg_size) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//string message = $&quot;进程消息：&#123;msg&#125;，大小：&#123;arg3&#125;\n附加消息：&#123;addition_msg&#125;，大小：&#123;addition_msg_size&#125;&quot;;</span></span><br><span class="line">    <span class="comment">//MessageBox.Show(message, &quot;回调提示&quot;);</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>目前忽略所有的回调消息。</p>
<h3 id="初始化-QQ-截图进程"><a href="#初始化-QQ-截图进程" class="headerlink" title="初始化 QQ 截图进程"></a>初始化 QQ 截图进程</h3><p>在 <em>Form1.cs</em> 的构造函数中初始化 QQ 截图进程，我们定义两个变量 <code>IntPtr parent</code> 和 <code>int pid</code> 用来保存实例化后的 <code>QQIpcParentWrapper</code> 和子进程的进程 ID</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> IntPtr parent;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> pid;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Form1</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 省略了...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.parent = QQIpcWrapper.CreateQQIpcParentWrapper();</span><br><span class="line">    <span class="built_in">bool</span> success = QQIpcWrapper.QQIpcParentWrapper_InitEnv(<span class="keyword">this</span>.parent, Application.StartupPath + <span class="string">&quot;parent-ipc-core-x64.dll&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!success)</span><br><span class="line">    &#123;</span><br><span class="line">        IntPtr ptr = QQIpcWrapper.QQIpcParentWrapper_GetLastErrStr(<span class="keyword">this</span>.parent);</span><br><span class="line">        <span class="built_in">string</span>? msg = Marshal.PtrToStringAnsi(ptr);</span><br><span class="line">        MessageBox.Show(msg, <span class="string">&quot;启动错误&quot;</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);</span><br><span class="line"></span><br><span class="line">        QQIpcWrapper.DeleteQQIpcChildWrapper(<span class="keyword">this</span>.parent);</span><br><span class="line"></span><br><span class="line">        Environment.Exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//QQIpcWrapper.QQIpcParentWrapper_SetLogLevel(this.parent, 0);</span></span><br><span class="line">    QQIpcWrapper.QQIpcParentWrapper_InitLog(<span class="keyword">this</span>.parent, <span class="number">0</span>, IntPtr.Zero);</span><br><span class="line">    QQIpcWrapper.QQIpcParentWrapper_InitParentIpc(<span class="keyword">this</span>.parent);</span><br><span class="line">    <span class="keyword">this</span>.pid = QQIpcWrapper.QQIpcParentWrapper_LaunchChildProcess(<span class="keyword">this</span>.parent, <span class="keyword">this</span>.config.QQScreenShot, callbackIpc, IntPtr.Zero, [], <span class="number">0</span>);</span><br><span class="line">    QQIpcWrapper.QQIpcParentWrapper_ConnectedToChildProcess(<span class="keyword">this</span>.parent, <span class="keyword">this</span>.pid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点击托盘图标开启截图"><a href="#点击托盘图标开启截图" class="headerlink" title="点击托盘图标开启截图"></a>点击托盘图标开启截图</h3><p>在 <em>Form1.cs</em> 选中 <em>notifyIcon1</em>，然后在 <em>Properties</em> 设置 <em>Action &gt; MouseClick</em> 为 <em>notifyIcon1_MouseClick</em></p>
<img src="/2025/03/29/qq-screen-shot-launcher/shot-6.png" class="">

<p><em>notifyIcon1_MouseClick</em> 方法的实现如下所示，发送给子进程的命令为 <code>screenShot</code>，命令内容来自 <code>QQScreenShotNT-Lite</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyIcon1_MouseClick</span>(<span class="params"><span class="built_in">object</span> sender, MouseEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (e.Button == MouseButtons.Left &amp;&amp; <span class="keyword">this</span>.config.EnableScreenShot == <span class="string">&quot;true&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        QQIpcWrapper.QQIpcParentWrapper_SendIpcMessage(<span class="keyword">this</span>.parent, <span class="keyword">this</span>.pid, <span class="string">&quot;screenShot&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="退出应用时结束子进程"><a href="#退出应用时结束子进程" class="headerlink" title="退出应用时结束子进程"></a>退出应用时结束子进程</h3><p>修改 <em>Form1.cs</em> 中的方法 <em>toolStripMenuItem7_Click</em>，退出应用时结束子进程并清理资源，如第 3~10 行所示</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toolStripMenuItem7_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.parent != IntPtr.Zero)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (pid &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            QQIpcWrapper.QQIpcParentWrapper_TerminateChildProcess(<span class="keyword">this</span>.parent, <span class="keyword">this</span>.pid, <span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        QQIpcWrapper.DeleteQQIpcParentWrapper(<span class="keyword">this</span>.parent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Application.Exit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C#</a>
              <a href="/tags/WinForms/" rel="tag"># WinForms</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/03/22/spring-cloud-canary-deployment/" rel="prev" title="Spring Cloud 全链路灰度发布">
                  <i class="fa fa-angle-left"></i> Spring Cloud 全链路灰度发布
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">逗号</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
